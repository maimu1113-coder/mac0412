<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<script src="/socket.io/socket.io.js"></script>
<script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.5.1/dist/confetti.browser.min.js"></script>
<style>
    /* OBSã§é€éã•ã›ã‚‹ãŸã‚ã®è¨­å®š */
    body { 
        margin: 0; 
        background: transparent !important; 
        overflow: hidden; 
        font-family: 'Hiragino Kaku Gothic Pro', 'BIZ UDPGothic', sans-serif;
    }
    
    #subtitle-box {
        position: absolute; 
        bottom: 50px; 
        left: 50px;
        color: white; 
        font-size: 48px; 
        font-weight: bold;
        /* æ–‡å­—ã®ç¸å–ã‚Šï¼ˆå¯èª­æ€§ã‚¢ãƒƒãƒ—ï¼‰ */
        text-shadow: 
            3px 3px 0 #000, -1px -1px 0 #000, 
            1px -1px 0 #000, -1px 1px 0 #000,
            0 0 10px rgba(0,0,0,0.8);
        padding: 15px 30px; 
        background: rgba(0, 0, 0, 0.5); /* åŠé€æ˜ã®é»’èƒŒæ™¯ */
        border-radius: 15px; 
        border-left: 12px solid #00f2ea; /* TikTokã‚«ãƒ©ãƒ¼ã®ã‚¢ã‚¯ã‚»ãƒ³ãƒˆ */
        opacity: 0; 
        transform: translateY(20px);
        transition: all 0.4s ease-out;
    }

    /* è¡¨ç¤ºã•ã‚Œã‚‹æ™‚ã®ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ */
    .show { 
        opacity: 1 !important; 
        transform: translateY(0) !important; 
    }
</style>
</head>
<body>

<div id="subtitle-box">æ¥ç¶šã‚’å¾…æ©Ÿä¸­...</div>

<script>
    const socket = io();
    const box = document.getElementById("subtitle-box");
    let timer;

    // ã‚µãƒ¼ãƒãƒ¼ã‹ã‚‰ã®ã‚¤ãƒ™ãƒ³ãƒˆã‚’å—ã‘å–ã‚‹
    socket.on("ev", e => {
        let message = "";
        
        if(e.t === "chat") {
            message = `${e.u}: ${e.m}`;
        } else if(e.t === "follow") {
            message = `ğŸ‘¤ ${e.u} ãŒãƒ•ã‚©ãƒ­ãƒ¼ï¼`;
            // ãƒ•ã‚©ãƒ­ãƒ¼æ™‚ã«ç´™å¹é›ª
            confetti({ particleCount: 50, spread: 70, origin: { y: 0.8 } });
        } else if(e.t === "gift") {
            message = `ğŸ ${e.u} ã•ã‚“ã‚®ãƒ•ãƒˆã‚ã‚ŠãŒã¨ã†ï¼`;
            // ã‚®ãƒ•ãƒˆæ™‚ã«è±ªè¯ãªç´™å¹é›ª
            confetti({ particleCount: 150, spread: 100, origin: { y: 0.6 }, colors: ['#ff0050', '#00f2ea'] });
        }

        if(message) {
            updateSubtitle(message);
        }
    });

    function updateSubtitle(text) {
        box.innerText = text;
        box.classList.add("show");

        // 6ç§’å¾Œã«è‡ªå‹•ã§æ¶ˆã™
        clearTimeout(timer);
        timer = setTimeout(() => {
            box.classList.remove("show");
        }, 6000);
    }
</script>
</body>
</html>
