<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>MacTok PRO</title>
<script src="/socket.io/socket.io.js"></script>
<style>
  body { margin: 0; background: #000; color: #fff; font-family: -apple-system, sans-serif; display: flex; align-items: center; justify-content: center; min-height: 100vh; }
  .card { background: #111; border-radius: 24px; padding: 25px; width: 90%; max-width: 400px; text-align: center; border: 1px solid #333; box-shadow: 0 0 40px rgba(0, 255, 234, 0.1); }
  h2 { margin: 0 0 20px 0; font-size: 24px; letter-spacing: 1px; }
  span.pro { color: #ff0050; }
  input { width: 100%; padding: 16px; margin-bottom: 15px; border-radius: 12px; border: 1px solid #444; background: #000; color: #fff; text-align: center; font-size: 16px; box-sizing: border-box; outline: none; transition: 0.3s; }
  input:focus { border-color: #ff0050; }
  button { width: 100%; padding: 16px; border-radius: 30px; border: none; background: linear-gradient(90deg, #ff0050, #00f2ea); color: #fff; font-size: 18px; font-weight: bold; cursor: pointer; transition: 0.2s; }
  button:active { transform: scale(0.95); opacity: 0.8; }
  #comment-box { height: 250px; overflow-y: auto; background: #0a0a0a; border-radius: 12px; padding: 15px; text-align: left; font-size: 14px; margin-top: 20px; border: 1px solid #222; }
  .comment { margin-bottom: 10px; border-bottom: 1px solid #1a1a1a; padding-bottom: 5px; animation: popIn 0.3s ease; }
  @keyframes popIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
  .user { color: #00f2ea; font-weight: bold; font-size: 12px; margin-right: 5px; }
  #status { margin-top: 15px; font-size: 12px; color: #666; }
</style>
</head>
<body>

<div class="card">
  <h2>MacTok <span class="pro">PRO</span></h2>
  <input type="text" id="tiktok-id" placeholder="IDã‚’å…¥åŠ› (ä¾‹: user123)">
  <button onclick="startEngine()">ENGINE START</button>
  <div id="comment-box">ã‚·ã‚¹ãƒ†ãƒ å¾…æ©Ÿä¸­...</div>
  <div id="status">Ready</div>
</div>

<script>
const socket = io({ transports: ["polling"] }); // Renderæ¨å¥¨è¨­å®š
const synth = window.speechSynthesis;
let voiceReady = false;

function speak(text) {
    if (!voiceReady) return;
    synth.cancel(); // é€£ç¶šã—ãŸæ™‚ã®é…å»¶é˜²æ­¢
    const utter = new SpeechSynthesisUtterance(text);
    utter.lang = 'ja-JP';
    utter.rate = 1.3; // å°‘ã—æ—©å£ã§èãå–ã‚Šã‚„ã™ã
    utter.volume = 1.0;
    synth.speak(utter);
}

function startEngine() {
    const id = document.getElementById("tiktok-id").value.trim();
    if (!id) return;

    // éŸ³å£°ã‚¨ãƒ³ã‚¸ãƒ³ã®å¼·åˆ¶èµ·å‹•ï¼ˆç„¡éŸ³å†ç”Ÿï¼‰
    voiceReady = true;
    speak(""); 

    document.getElementById("status").innerText = "â³ ã‚µãƒ¼ãƒãƒ¼ã¸æ¥ç¶šä¸­...";
    document.getElementById("comment-box").innerText = "æ¥ç¶šã‚’ç¢ºç«‹ã—ã¦ã„ã¾ã™...";
    
    // ã‚µãƒ¼ãƒãƒ¼ã¸æ¥ç¶šè¦æ±‚
    socket.emit("connect-live", id);
}

socket.on("new-comment", (data) => {
    const box = document.getElementById("comment-box");
    // åˆå›ã®å¾…æ©Ÿãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’æ¶ˆã™
    if (box.innerText.includes("ã‚·ã‚¹ãƒ†ãƒ å¾…æ©Ÿä¸­") || box.innerText.includes("æ¥ç¶šã‚’ç¢ºç«‹")) {
        box.innerHTML = "";
    }

    const div = document.createElement("div");
    div.className = "comment";
    div.innerHTML = `<span class="user">@${data.user}</span> ${data.text}`;
    box.prepend(div);
    
    speak(data.text);
});

socket.on("live-status", (msg) => {
    document.getElementById("status").innerText = msg;
    if(msg.includes("æ¥ç¶šæˆåŠŸ")) {
        document.getElementById("comment-box").innerText = "ğŸ“¡ ãƒ©ã‚¤ãƒ–ã‚³ãƒ¡ãƒ³ãƒˆå—ä¿¡ä¸­...";
    }
});
</script>
</body>
</html>
