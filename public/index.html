<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0,viewport-fit=cover">
<title>Mac Talk PRO</title>
<script src="/socket.io/socket.io.js"></script>
<style>
:root{--bg:#0b0e14;--side:#161920;--card:#1f232d;--accent:#00f2ea;--pink:#ff0050}
body{font-family:sans-serif;background:var(--bg);color:#fff;margin:0;display:flex;height:100vh;overflow:hidden}
.sidebar{width:60px;min-width:60px;background:var(--side);display:flex;flex-direction:column;align-items:center;padding-top:30px;gap:35px;border-right:1px solid #333}
.side-btn{font-size:1.5rem;cursor:pointer;opacity:0.6;transition:0.2s}
.side-btn:active{opacity:1;transform:scale(1.2)}
.main{flex:1;display:flex;flex-direction:column;padding:15px;overflow:hidden}
.card{background:var(--card);padding:15px;border-radius:12px;margin-bottom:10px;border:1px solid #444}
input{width:100%;padding:15px;background:#000;border:1px solid #555;color:#fff;border-radius:8px;box-sizing:border-box;font-size:18px;margin-bottom:12px}
button{width:100%;padding:16px;border-radius:10px;border:none;font-weight:bold;margin-bottom:10px;font-size:16px}
.btn-pink{background:var(--pink);color:#fff}
.btn-blue{background:var(--accent);color:#000}
#log-area{flex:1;overflow-y:auto;display:flex;flex-direction:column;gap:8px;padding:10px;background:rgba(255,255,255,0.02);border-radius:8px}
.log-item{background:var(--card);padding:12px;border-radius:8px;border-left:4px solid var(--accent);font-size:0.9rem;color:#fff}
</style>
</head>
<body>

<div class="sidebar">
    <div class="side-btn" onclick="location.reload()">ğŸ </div>
    <div class="side-btn" onclick="checkMic()">ğŸ¤</div>
    <div class="side-btn" onclick="showSettings()">âš™ï¸</div>
</div>

<div class="main">
    <div style="display:flex;justify-content:space-between;margin-bottom:10px">
        <h2 style="margin:0">Mac Talk <span style="color:var(--accent)">PRO</span></h2>
        <div style="background:#222;padding:4px 10px;border-radius:15px;font-size:0.8rem">ğŸ‘ï¸ <span id="vCount">0</span></div>
    </div>
    <div class="card">
        <input id="tid" type="text" placeholder="TikTok ID (@ãªã—)">
        <button id="b1" class="btn-pink" onclick="clickStart()">1. èª­ã¿ä¸Šã’ã‚’æœ‰åŠ¹ã«ã™ã‚‹</button>
        <button id="b2" class="btn-blue" onclick="clickConnect()">2. ä¿å­˜ã—ã¦ãƒ©ã‚¤ãƒ–æ¥ç¶š</button>
    </div>
    <div id="log-area"><div class="log-item">ãƒ­ã‚°å¾…æ©Ÿä¸­...</div></div>
</div>

<audio id="silent-audio" loop playsinline src="https://raw.githubusercontent.com/anars/blank-audio/master/10-seconds-of-silence.mp3"></audio>

<script>
var socket = io();
var isEngineOn = false;
var queue = [];
var isTalking = false;

function addLog(msg) {
    var area = document.getElementById("log-area");
    var d = document.createElement("div"); d.className = "log-item"; d.innerText = msg;
    area.insertBefore(d, area.firstChild);
}

function checkMic() { addLog("ğŸ¤ èª­ã¿ä¸Šã’çŠ¶æ…‹: " + (isEngineOn ? "æœ‰åŠ¹" : "ç„¡åŠ¹")); }
function showSettings() { addLog("âš™ï¸ è¨­å®š: è‡ªå‹•å†æ¥ç¶šãƒ»é«˜å„ªå…ˆåº¦ãƒ¢ãƒ¼ãƒ‰"); }

// 1. èª­ã¿ä¸Šã’æœ‰åŠ¹åŒ–ï¼ˆãƒ­ã‚´è¡¨ç¤ºã¨ãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰ç¶­æŒï¼‰
function clickStart() {
    isEngineOn = true;
    var audio = document.getElementById("silent-audio");
    
    // iPhoneã«å†ç”Ÿã‚’å¼·åˆ¶èªè­˜ã•ã›ã‚‹
    audio.play().then(function() {
        addLog("âœ… ã‚·ã‚¹ãƒ†ãƒ ï¼šéŸ³å£°ã‚¨ãƒ³ã‚¸ãƒ³èµ·å‹•ï¼ˆãƒ­ã‚´ç¢ºèªå¯ï¼‰");
    });
    
    var ut = new SpeechSynthesisUtterance("ãƒãƒƒã‚¯ãƒˆãƒ¼ã‚¯ã€èª­ã¿ä¸Šã’ã‚’é–‹å§‹ã—ã¾ã™ã€‚");
    ut.lang = 'ja-JP';
    window.speechSynthesis.speak(ut);

    document.getElementById("b1").innerText = "èª­ã¿ä¸Šã’æœ‰åŠ¹ä¸­";
    document.getElementById("b1").style.opacity = "0.7";
}

// 2. æ¥ç¶šè¦æ±‚
function clickConnect() {
    var id = document.getElementById("tid").value.replace("@", "").trim();
    if(!id) { alert("IDã‚’å…¥åŠ›ã—ã¦ãã ã•ã„"); return; }
    addLog("â³ æ¥ç¶šè¦æ±‚ï¼šTikTokã¸ã‚¢ã‚¯ã‚»ã‚¹ä¸­...");
    socket.emit("setTarget", id);
    localStorage.setItem("mtid", id);
}

socket.on("ev", function(e) {
    var l = "", s = "";
    if(e.t === "chat") { l = "ğŸ’¬ " + e.u + ": " + e.m; s = e.u + "ã•ã‚“ " + e.m; }
    if(e.t === "follow") { l = "ğŸ‘¤ " + e.u + " Follow!"; s = e.u + "ã•ã‚“ãƒ•ã‚©ãƒ­ãƒ¼ã‚ã‚ŠãŒã¨ã†"; }
    if(e.t === "gift") { l = "ğŸ " + e.u + ": " + e.g + " x" + e.c; s = e.u + "ã•ã‚“" + e.g + "ã‚ã‚ŠãŒã¨ã†"; }
    if(e.t === "sys") { l = "ğŸ“¢ " + e.m; }
    if(l) addLog(l);
    if(s && isEngineOn) { queue.push(s); talk(); }
});

socket.on("up-v", function(c) { document.getElementById("vCount").innerText = c; });

function talk() {
    if(!isEngineOn || isTalking || queue.length === 0) return;
    isTalking = true;
    var u = new SpeechSynthesisUtterance(queue.shift());
    u.lang = 'ja-JP'; u.rate = 1.2;
    u.onend = function() { isTalking = false; talk(); };
    window.speechSynthesis.speak(u);
}

window.onload = function() {
    var saved = localStorage.getItem("mtid");
    if(saved) document.getElementById("tid").value = saved;
};
</script>
</body>
</html>
