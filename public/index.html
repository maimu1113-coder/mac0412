<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
<title>TikFinity PRO UI</title>
<script src="/socket.io/socket.io.js"></script>
<style>
:root{--bg:#0b0e14;--side:#161920;--card:#1f232d;--accent:#00f2ea;--pink:#ff0050}
body{font-family:sans-serif;background:var(--bg);color:#fff;margin:0;display:flex;height:100vh;overflow:hidden}

/* å·¦å´ã‚µã‚¤ãƒ‰ãƒ¡ãƒ‹ãƒ¥ãƒ¼ï¼ˆç”»åƒã®ã‚¢ã‚¤ã‚³ãƒ³ä¸¦ã³ã‚’å†ç¾ï¼‰ */
.sidebar{width:60px;background:var(--side);display:flex;flex-direction:column;align-items:center;padding-top:40px;gap:25px;border-right:1px solid #2d323e}
.side-icon{width:30px;height:30px;opacity:0.5;transition:0.3s}
.side-icon.active{opacity:1;filter:drop-shadow(0 0 5px var(--accent))}

/* ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚¨ãƒªã‚¢ */
.main-content{flex:1;display:flex;flex-direction:column;padding:20px;box-sizing:border-box;position:relative}

/* è¨­å®šãƒ‘ãƒãƒ«ï¼ˆã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤ï¼‰ */
#settingsOverlay{position:absolute;top:0;left:0;width:100%;height:100%;background:var(--bg);z-index:10;display:none;padding:20px;box-sizing:border-box;overflow-y:auto}
.tab-content{display:none}
.tab-content.active{display:block}

/* è¨­å®šã‚«ãƒ¼ãƒ‰ */
.card{background:var(--card);border-radius:12px;padding:15px;margin-bottom:15px;border:1px solid #333}
.label{font-size:0.7rem;color:var(--accent);text-transform:uppercase;margin-bottom:8px;display:block}
input, select, textarea{width:100%;background:#0b0e14;border:1px solid #444;color:#fff;padding:10px;border-radius:8px;box-sizing:border-box}

/* ãƒ­ã‚°ã‚¨ãƒªã‚¢ */
#eventLog{flex:1;overflow-y:auto;display:flex;flex-direction:column-reverse;gap:10px}
.log-card{background:var(--card);padding:12px;border-radius:10px;font-size:0.8rem;border-left:4px solid #444}

.btn-save{background:var(--accent);color:#000;border:none;padding:15px;width:100%;border-radius:10px;font-weight:bold;margin-top:10px}
.header-row{display:flex;justify-content:space-between;align-items:center;margin-bottom:15px}
</style>
</head>
<body>

<div class="sidebar">
    <div onclick="showTab('main')" class="side-icon active">ğŸ </div>
    <div onclick="showTab('tts')" class="side-icon">ğŸ¤</div>
    <div onclick="showTab('events')" class="side-icon">âš¡</div>
    <div onclick="toggleSettings()" class="side-icon">âš™ï¸</div>
</div>

<div class="main-content">
    <div class="header-row">
        <div style="font-weight:900;font-size:1.2rem">Tik<span style="color:var(--pink)">Finity</span></div>
        <div id="v-badge" style="background:#222;padding:4px 8px;border-radius:5px;font-size:0.7rem">ğŸ‘ï¸ <span id="viewCount">0</span></div>
    </div>

    <div id="eventLog"></div>

    <div id="settingsOverlay">
        <div class="header-row">
            <h2 id="tabTitle">Settings</h2>
            <button onclick="toggleSettings()" style="background:none;border:none;color:#888">CLOSE</button>
        </div>

        <div id="tab-main" class="tab-content active">
            <div class="card"><label class="label">TikTok ID</label><input type="text" id="targetId" placeholder="@lxxchipxxl"></div>
            <div class="card">
                <label class="label">Voice Speed</label>
                <input type="range" id="v-speed" min="0.5" max="2.0" step="0.1" value="1.2">
            </div>
            <button class="btn-save" onclick="apply()">SAVE & CONNECT</button>
        </div>

        <div id="tab-tts" class="tab-content">
            <div class="card"><label class="label">Pitch (å£°ã®é«˜ã•)</label><input type="range" id="v-pitch" min="0.5" max="2.0" step="0.1" value="1.0"></div>
            <div class="card"><label class="label">Voice Type</label><select id="voiceSelect"></select></div>
        </div>

        <div id="tab-events" class="tab-content">
            <div class="card"><label class="label">Follow Message</label><textarea id="m-follow">{user}ã•ã‚“ãƒ•ã‚©ãƒ­ãƒ¼ã‚ã‚ŠãŒã¨ã†ï¼</textarea></div>
            <div class="card"><label class="label">Gift Message</label><textarea id="m-gift">{user}ã•ã‚“{gift}ã‚ã‚ŠãŒã¨ã†ï¼</textarea></div>
        </div>
    </div>
</div>

<video id="pip" playsinline muted loop style="display:none"><source src="https://raw.githubusercontent.com/Anarios/return-to-fame/master/assets/empty.mp4"></video>

<script>
const socket=io();
let engineActive=false, voices=[];

function toggleSettings(){
    const s = document.getElementById('settingsOverlay');
    s.style.display = s.style.display === 'block' ? 'none' : 'block';
}

function showTab(name){
    document.querySelectorAll('.tab-content').forEach(t=>t.classList.remove('active'));
    document.getElementById('tab-'+name).classList.add('active');
    document.getElementById('tabTitle').innerText = name.toUpperCase();
}

function apply(){
    const id = document.getElementById('targetId').value;
    if(id) socket.emit('setTarget', id);
    engineActive=true;
    document.getElementById('pip').play();
    toggleSettings();
}

// éŸ³å£°ãƒªã‚¹ãƒˆå–å¾—
function getVoices(){
    voices = window.speechSynthesis.getVoices().filter(v=>v.lang.includes('ja'));
    const s = document.getElementById('voiceSelect');
    s.innerHTML = voices.map((v,i)=>`<option value="${i}">${v.name}</option>`).join('');
}
window.speechSynthesis.onvoiceschanged = getVoices; getVoices();

socket.on('ev', e => {
    let msg = "";
    if(e.t==='chat') { msg = `${e.u}ã•ã‚“ï¼š${e.m}`; addLog('ğŸ’¬ '+msg, var(--accent)); }
    if(e.t==='follow') { msg = document.getElementById('m-follow').value.replace('{user}', e.u); addLog('ğŸ‘¤ '+e.u+' Followed', '#ffeb3b'); }
    if(e.t==='gift') { msg = document.getElementById('m-gift').value.replace('{user}',e.u).replace('{gift}',e.g); addLog('ğŸ '+e.u+' sent '+e.g, var(--pink)); }
    if(engineActive) speak(msg);
});

socket.on('up-v', c => document.getElementById('viewCount').innerText = c);

function addLog(m, c){
    const d=document.createElement('div'); d.className='log-card';
    d.style.borderLeftColor=c; d.innerHTML=m;
    document.getElementById('eventLog').prepend(d);
}

function speak(t){
    if(!engineActive) return;
    const u=new SpeechSynthesisUtterance(t);
    const vIdx = document.getElementById('voiceSelect').value;
    if(voices[vIdx]) u.voice = voices[vIdx];
    u.rate = parseFloat(document.getElementById('v-speed').value);
    u.pitch = parseFloat(document.getElementById('v-pitch').value);
    window.speechSynthesis.speak(u);
}
</script>
</body>
</html>
