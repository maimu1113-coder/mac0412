<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>Mac Talk PRO</title>
<script src="/socket.io/socket.io.js"></script>
<style>
body{margin:0;background:#0b0e14;color:#fff;font-family:sans-serif}
header{padding:15px;font-weight:900}
#log{padding:10px;height:60vh;overflow:auto}
.card{background:#1f232d;margin-bottom:8px;padding:10px;border-radius:10px}
button,input{width:100%;padding:12px;margin-top:10px;border-radius:10px;border:none}
button{font-weight:bold}
</style>
</head>
<body>

<header>
Mac Talk PROã€€ğŸ‘ï¸ <span id="v">0</span>
</header>

<div style="padding:10px">
<input id="tid" placeholder="TikTok ID (@ãªã—)">
<button onclick="startAudio()">â‘  èª­ã¿ä¸Šã’ã‚’æœ‰åŠ¹</button>
<button onclick="connect()">â‘¡ æ¥ç¶š</button>
</div>

<div id="log"></div>

<video id="pip" muted loop playsinline style="display:none">
<source src="https://raw.githubusercontent.com/Anarios/return-to-fame/master/assets/empty.mp4">
</video>

<script>
const socket = io();
let engine=false, queue=[], talking=false;
let lastEvent=Date.now();

const autoMsgs=[
 "ã‚³ãƒ¡ãƒ³ãƒˆå¤§æ­“è¿ã§ã™ï¼",
 "åˆè¦‹ã•ã‚“ã‚‚ã©ã†ãã€œ",
 "ã‚†ã£ãã‚Šã—ã¦ã„ã£ã¦ã­ï¼"
];

function startAudio(){
  engine=true;
  speech("ãƒãƒƒã‚¯ãƒˆãƒ¼ã‚¯ã‚’èµ·å‹•ã—ã¾ã—ãŸ");
  document.getElementById("pip").play();
  setInterval(autoTalk,20000);
}

function connect(){
  const id=document.getElementById("tid").value.trim();
  if(id) socket.emit("setTarget",id);
}

socket.on("ev",e=>{
  lastEvent=Date.now();
  let msg="";
  if(e.t==="chat") msg=`${e.u}ã•ã‚“ã€${e.m}`;
  if(e.t==="follow") msg=`${e.u}ã•ã‚“ãƒ•ã‚©ãƒ­ãƒ¼ã‚ã‚ŠãŒã¨ã†`;
  if(e.t==="gift") msg=`${e.u}ã•ã‚“${e.g}ã‚ã‚ŠãŒã¨ã†`;
  if(e.t==="sys") msg=e.m;

  if(msg){
    log(msg);
    queue.push(msg);
    speakQueue();
  }
});

socket.on("view",c=>{
  document.getElementById("v").innerText=c;
});

function speakQueue(){
  if(!engine||talking||queue.length===0) return;
  talking=true;
  const u=new SpeechSynthesisUtterance(queue.shift());
  u.lang="ja-JP";
  u.rate=1.2;
  u.onend=()=>{ talking=false; speakQueue(); };
  speechSynthesis.speak(u);
}

function autoTalk(){
  if(!engine||Date.now()-lastEvent<20000) return;
  queue.push(autoMsgs[Math.floor(Math.random()*autoMsgs.length)]);
  speakQueue();
}

function speech(t){
  const u=new SpeechSynthesisUtterance(t);
  u.lang="ja-JP";
  speechSynthesis.speak(u);
}

function log(t){
  const d=document.createElement("div");
  d.className="card";
  d.innerText=t;
  document.getElementById("log").prepend(d);
}
</script>
</body>
</html>
