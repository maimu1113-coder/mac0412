<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0,viewport-fit=cover">
<title>Mac Talk PRO Control</title>
<script src="/socket.io/socket.io.js"></script>
<style>
:root{--bg:#0b0e14;--side:#161920;--card:#1f232d;--accent:#00f2ea;--pink:#ff0050}
body{font-family:sans-serif;background:var(--bg);color:#fff;margin:0;display:flex;height:100vh;overflow:hidden}
.sidebar{width:60px;background:var(--side);display:flex;flex-direction:column;align-items:center;padding-top:30px;gap:25px;border-right:1px solid #333}
.main{flex:1;padding:20px;overflow-y:auto;display:flex;flex-direction:column}
.card{background:var(--card);padding:15px;border-radius:12px;margin-bottom:10px;border:1px solid #333}
input{width:100%;padding:12px;background:#000;border:1px solid #444;color:#fff;border-radius:8px;box-sizing:border-box;font-size:16px}
button{width:100%;padding:15px;margin-top:10px;border-radius:10px;border:none;font-weight:bold;cursor:pointer}
.btn-pink{background:var(--pink);color:#fff}
.btn-blue{background:var(--accent);color:#000}
#log{flex:1;margin-top:15px;overflow-y:auto;font-size:0.85rem;display:flex;flex-direction:column-reverse;gap:5px}
.log-item{background:#252a35;padding:10px;border-radius:8px;border-left:4px solid var(--accent)}
</style>
</head>
<body>
<div class="sidebar"><div>ğŸ </div><div>ğŸ¤</div><div>âš™ï¸</div></div>
<div class="main">
    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:15px">
        <h2 style="margin:0">Mac Talk <span style="color:var(--accent)">PRO</span></h2>
        <div style="background:#222;padding:4px 10px;border-radius:15px;font-size:0.75rem">ğŸ‘ï¸ <span id="vCount">0</span></div>
    </div>
    <div class="card">
        <input id="tid" placeholder="TikTok ID (@ãªã—)">
        <button class="btn-pink" onclick="startAudio()">1. èª­ã¿ä¸Šã’ã‚’æœ‰åŠ¹ã«ã™ã‚‹</button>
        <button class="btn-blue" onclick="connect()">2. ä¿å­˜ã—ã¦ãƒ©ã‚¤ãƒ–æ¥ç¶š</button>
    </div>
    <div id="log"></div>
</div>
<video id="pip" muted loop playsinline style="display:none"><source src="https://raw.githubusercontent.com/Anarios/return-to-fame/master/assets/empty.mp4"></video>

<script>
const socket=io();
let engine=false, queue=[], talking=false, lastEv=Date.now();
const autoMsgs = ["ã‚³ãƒ¡ãƒ³ãƒˆå¤§æ­“è¿ã§ã™ï¼","åˆè¦‹ã•ã‚“ã‚‚ã‚†ã£ãã‚Šã—ã¦ã„ã£ã¦ã­","å¿œæ´ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã™ï¼"];

function startAudio(){
    engine=true;
    const u=new SpeechSynthesisUtterance("èª­ã¿ä¸Šã’ã‚’é–‹å§‹ã—ã¾ã™ã€‚è‡ªå‹•ç››ã‚Šä¸Šã’ãƒ¢ãƒ¼ãƒ‰æœ‰åŠ¹ã€‚");
    u.lang='ja-JP'; window.speechSynthesis.speak(u);
    document.getElementById("pip").play();
    setInterval(checkAutoTalk, 25000); // 25ç§’é–“ç„¡è¨€ãªã‚‰è‡ªå‹•ãƒˆãƒ¼ã‚¯
}

function connect(){
    const id=document.getElementById("tid").value.trim();
    if(id){ socket.emit("setTarget", id); localStorage.setItem("mtid", id); }
}

window.onload=()=>{ if(localStorage.getItem("mtid")) document.getElementById("tid").value=localStorage.getItem("mtid"); };

socket.on("ev", e => {
    lastEv = Date.now();
    let t="";
    if(e.t==="chat") t=`${e.u}ã•ã‚“ã€${e.m}`;
    if(e.t==="follow") t=`${e.u}ã•ã‚“ãƒ•ã‚©ãƒ­ãƒ¼ã‚ã‚ŠãŒã¨ã†ï¼`;
    if(e.t==="gift") t=`${e.u}ã•ã‚“ã€${e.g}ã‚’${e.c}å€‹ã‚‚ã‚ã‚ŠãŒã¨ã†ï¼`;
    if(e.t==="sys") t=e.m;
    if(t) { addLog(t); queue.push(t); speak(); }
});

socket.on("up-v", c => document.getElementById("vCount").innerText = c);

function speak(){
    if(!engine || talking || queue.length===0) return;
    talking=true;
    const u=new SpeechSynthesisUtterance(queue.shift());
    u.lang='ja-JP'; u.rate=1.2;
    u.onend=()=>{ talking=false; speak(); };
    window.speechSynthesis.speak(u);
}

function checkAutoTalk(){
    if(engine && Date.now()-lastEv > 25000 && !talking){
        const m = autoMsgs[Math.floor(Math.random()*autoMsgs.length)];
        queue.push(m); speak();
    }
}

function addLog(m){
    const d=document.createElement("div"); d.className="log-item";
    d.innerText=m; document.getElementById("log").prepend(d);
}
</script>
</body>
</html>
