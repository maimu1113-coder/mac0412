<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0,viewport-fit=cover">
<title>Mac Talk PRO</title>
<script src="/socket.io/socket.io.js"></script>
<style>
:root{--bg:#0b0e14;--side:#161920;--card:#1f232d;--accent:#00f2ea;--pink:#ff0050}
body{font-family:sans-serif;background:var(--bg);color:#fff;margin:0;display:flex;height:100vh;overflow:hidden}

/* ã‚µã‚¤ãƒ‰ãƒãƒ¼ */
.sidebar{width:60px;min-width:60px;background:var(--side);display:flex;flex-direction:column;align-items:center;padding-top:30px;gap:25px;border-right:1px solid #333}
.side-icon{font-size:1.5rem;opacity:0.5}

/* ãƒ¡ã‚¤ãƒ³ã‚¨ãƒªã‚¢ */
.main{flex:1;display:flex;flex-direction:column;padding:15px;box-sizing:border-box;overflow:hidden}
.header{display:flex;justify-content:space-between;align-items:center;margin-bottom:10px}
.card{background:var(--card);padding:15px;border-radius:12px;margin-bottom:15px;border:1px solid #444}

/* å…¥åŠ›ãƒ»ãƒœã‚¿ãƒ³ */
input{width:100%;padding:12px;background:#000;border:1px solid #555;color:#fff;border-radius:8px;box-sizing:border-box;font-size:16px;margin-bottom:10px}
button{width:100%;padding:14px;border-radius:10px;border:none;font-weight:bold;margin-bottom:8px;cursor:pointer}
.btn-pink{background:var(--pink);color:#fff}
.btn-blue{background:var(--accent);color:#000}

/* ğŸš€ ãƒ­ã‚°è¡¨ç¤ºã‚¨ãƒªã‚¢ï¼ˆã“ã“ã‚’å¼·åŒ–ã—ã¾ã—ãŸï¼‰ */
#log-area{
    flex:1;
    overflow-y:auto;
    display:flex;
    flex-direction:column; /* ä¸Šã‹ã‚‰é †ã«è¡¨ç¤º */
    gap:8px;
    background: rgba(255,255,255,0.02); /* ãƒ‡ãƒãƒƒã‚°ç”¨ã«è–„ãè‰²ä»˜ã‘ */
    padding:10px;
    border-radius:8px;
}
.log-item{
    background:var(--card);
    padding:10px;
    border-radius:8px;
    border-left:4px solid var(--accent);
    font-size:0.9rem;
    line-height:1.4;
    word-break:break-all;
    color: #fff !important; /* æ–‡å­—è‰²ã‚’å¼·åˆ¶ */
}
</style>
</head>
<body>

<div class="sidebar">
    <div class="side-icon" style="opacity:1">ğŸ </div>
    <div class="side-icon">ğŸ¤</div>
    <div class="side-icon">âš™ï¸</div>
</div>

<div class="main">
    <div class="header">
        <h2 style="margin:0;font-size:1.2rem">Mac Talk <span style="color:var(--accent)">PRO</span></h2>
        <div style="background:#222;padding:4px 10px;border-radius:15px;font-size:0.75rem">ğŸ‘ï¸ <span id="vCount">0</span></div>
    </div>
    
    <div class="card">
        <input id="tid" placeholder="TikTok IDã‚’å…¥åŠ›">
        <button class="btn-pink" onclick="initAudio()">1. èª­ã¿ä¸Šã’ã‚’æœ‰åŠ¹ã«ã™ã‚‹</button>
        <button class="btn-blue" onclick="connect()">2. ä¿å­˜ã—ã¦ãƒ©ã‚¤ãƒ–æ¥ç¶š</button>
    </div>

    <div id="log-area">
        <div class="log-item" style="border-left-color:#888">ãƒ­ã‚°å¾…æ©Ÿä¸­...</div>
    </div>
</div>

<video id="pip" muted loop playsinline style="display:none"><source src="https://raw.githubusercontent.com/Anarios/return-to-fame/master/assets/empty.mp4"></video>

<script>
const socket = io();
let engineOn = false;
let queue = [];
let talking = false;
const logArea = document.getElementById("log-area");

// éŸ³å£°ã‚¨ãƒ³ã‚¸ãƒ³ã®åˆæœŸåŒ–
function initAudio(){
    engineOn = true;
    const u = new SpeechSynthesisUtterance("èª­ã¿ä¸Šã’ã‚’é–‹å§‹ã—ã¾ã™ã€‚");
    u.lang = 'ja-JP';
    window.speechSynthesis.speak(u);
    document.getElementById("pip").play();
    addLog("ğŸ“¢ ã‚·ã‚¹ãƒ†ãƒ : èª­ã¿ä¸Šã’ãŒæœ‰åŠ¹ã«ãªã‚Šã¾ã—ãŸ");
}

// æ¥ç¶šå®Ÿè¡Œ
function connect(){
    const id = document.getElementById("tid").value.trim();
    if(id){
        socket.emit("setTarget", id);
        localStorage.setItem("mtid", id);
        addLog(`ğŸ“¢ ã‚·ã‚¹ãƒ†ãƒ : ${id} ã«æ¥ç¶šã‚’è©¦ã¿ã¦ã„ã¾ã™...`);
    }
}

// ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã«IDã‚’å¾©å…ƒ
window.onload = () => {
    const savedId = localStorage.getItem("mtid");
    if(savedId) document.getElementById("tid").value = savedId;
};

// ã‚µãƒ¼ãƒãƒ¼ã‹ã‚‰ã®ã‚¤ãƒ™ãƒ³ãƒˆå—ä¿¡
socket.on("ev", e => {
    let logMsg = "";
    let speechMsg = "";

    if(e.t === "chat") {
        logMsg = `ğŸ’¬ ${e.u}: ${e.m}`;
        speechMsg = `${e.u}ã•ã‚“ ${e.m}`;
    } else if(e.t === "follow") {
        logMsg = `ğŸ‘¤ ${e.u} ãŒãƒ•ã‚©ãƒ­ãƒ¼ã—ã¾ã—ãŸ`;
        speechMsg = `${e.u}ã•ã‚“ãƒ•ã‚©ãƒ­ãƒ¼ã‚ã‚ŠãŒã¨ã†`;
    } else if(e.t === "gift") {
        logMsg = `ğŸ ${e.u}: ${e.g} x${e.c}`;
        speechMsg = `${e.u}ã•ã‚“${e.g}ã‚ã‚ŠãŒã¨ã†`;
    } else if(e.t === "sys") {
        logMsg = `ğŸ“¢ ${e.m}`;
    }

    if(logMsg) addLog(logMsg);
    if(speechMsg && engineOn) {
        queue.push(speechMsg);
        speakNext();
    }
});

socket.on("up-v", c => {
    document.getElementById("vCount").innerText = c;
});

// èª­ã¿ä¸Šã’å‡¦ç†
function speakNext(){
    if(!engineOn || talking || queue.length === 0) return;
    talking = true;
    const u = new SpeechSynthesisUtterance(queue.shift());
    u.lang = 'ja-JP';
    u.rate = 1.2;
    u.onend = () => {
        talking = false;
        speakNext();
    };
    window.speechSynthesis.speak(u);
}

// ğŸš€ ãƒ­ã‚°ã‚’è¿½åŠ ã™ã‚‹é–¢æ•°
function addLog(msg) {
    const div = document.createElement("div");
    div.className = "log-item";
    div.innerText = msg;
    
    // ä¸€ç•ªä¸Šã«æ–°ã—ã„ãƒ­ã‚°ã‚’è¿½åŠ 
    logArea.insertBefore(div, logArea.firstChild);
    
    // ãƒ­ã‚°ãŒæºœã¾ã‚Šã™ããŸã‚‰å¤ã„ã‚‚ã®ã‚’æ¶ˆã™ï¼ˆå‹•ä½œã‚’è»½ãã™ã‚‹ãŸã‚ï¼‰
    if(logArea.childNodes.length > 50) {
        logArea.removeChild(logArea.lastChild);
    }
}
</script>
</body>
</html>
