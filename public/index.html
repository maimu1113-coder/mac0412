<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
<title>Mac Talk PRO</title>
<script src="/socket.io/socket.io.js"></script>
<style>
:root{--bg:#0b0e14;--side:#161920;--card:#1f232d;--accent:#00f2ea;--pink:#ff0050}
body{font-family:sans-serif;background:var(--bg);color:#fff;margin:0;display:flex;height:100vh;overflow:hidden;touch-action:manipulation}

/* Sidebar */
.sidebar{width:65px;background:var(--side);display:flex;flex-direction:column;align-items:center;padding-top:40px;gap:35px;border-right:1px solid #2d323e;z-index:20}
.side-icon{font-size:1.8rem;opacity:0.4;cursor:pointer;padding:10px}
.side-icon.active{opacity:1;filter:drop-shadow(0 0 5px var(--accent))}

/* Main */
.main-content{flex:1;display:flex;flex-direction:column;padding:20px;position:relative;z-index:5}
#settingsOverlay{position:absolute;top:0;left:0;width:100%;height:100%;background:var(--bg);z-index:100;display:none;padding:20px;box-sizing:border-box;overflow-y:auto}
.tab-content{display:none;padding-bottom:100px}
.tab-content.active{display:block}

/* Elements */
.card{background:var(--card);border-radius:12px;padding:15px;margin-bottom:15px;border:1px solid #333}
.label{font-size:0.75rem;color:var(--accent);text-transform:uppercase;margin-bottom:8px;display:block;font-weight:bold}
input, select, textarea{width:100%;background:#0b0e14;border:1px solid #444;color:#fff;padding:15px;border-radius:8px;font-size:1rem;box-sizing:border-box}

#eventLog{flex:1;overflow-y:auto;display:flex;flex-direction:column-reverse;gap:10px}
.log-card{background:var(--card);padding:12px;border-radius:10px;font-size:0.85rem;border-left:4px solid #444}

.btn-main{background:var(--pink);color:#fff;border:none;padding:18px;width:100%;border-radius:12px;font-weight:bold;font-size:1rem;margin-bottom:10px;touch-action:none}
.btn-save{background:var(--accent);color:#000;border:none;padding:18px;width:100%;border-radius:12px;font-weight:bold;font-size:1rem}
</style>
</head>
<body>

<div class="sidebar">
    <div id="i-main" onclick="showTab('main')" class="side-icon active">üè†</div>
    <div id="i-tts" onclick="showTab('tts')" class="side-icon">üé§</div>
    <div id="i-events" onclick="showTab('events')" class="side-icon">‚ö°</div>
    <div onclick="toggleSettings()" class="side-icon">‚öôÔ∏è</div>
</div>

<div class="main-content">
    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:15px">
        <div style="font-weight:900;font-size:1.4rem">Mac<span style="color:var(--accent)">Talk</span></div>
        <div style="background:#222;padding:5px 10px;border-radius:20px;font-size:0.7rem">LIVE: <span id="vCount">0</span></div>
    </div>
    <div id="eventLog"></div>

    <div id="settingsOverlay">
        <div style="display:flex;justify-content:space-between;margin-bottom:20px">
            <h2 id="tabTitle">SETTINGS</h2>
            <button onclick="toggleSettings()" style="background:none;border:none;color:#888;font-size:1.2rem;padding:10px">CLOSE</button>
        </div>

        <div id="tab-main" class="tab-content active">
            <div class="card"><label class="label">TikTok ID</label><input type="text" id="targetId"></div>
            <button id="audioStartBtn" class="btn-main">ACTIVATE AUDIO</button>
            <button class="btn-save" onclick="applyAndConnect()">SAVE & CONNECT</button>
        </div>

        <div id="tab-tts" class="tab-content">
            <div class="card"><label class="label">Voice Type</label><select id="voiceSelect"></select></div>
            <div class="card"><label class="label">Pitch</label><input type="range" id="v-pitch" min="0.5" max="2.0" step="0.1" value="1.0"></div>
            <div class="card"><label class="label">Speed</label><input type="range" id="v-speed" min="0.5" max="2.0" step="0.1" value="1.2"></div>
        </div>

        <div id="tab-events" class="tab-content">
            <div class="card"><label class="label">Follow Msg</label><textarea id="m-follow">{user}„Åï„Çì„Éï„Ç©„É≠„Éº„ÅÇ„Çä„Åå„Å®„ÅÜÔºÅ</textarea></div>
            <div class="card"><label class="label">Gift Msg</label><textarea id="m-gift">{user}„Åï„Çì{gift}„ÅÇ„Çä„Åå„Å®„ÅÜÔºÅ</textarea></div>
        </div>
    </div>
</div>

<video id="pip" playsinline muted loop style="display:none"><source src="https://raw.githubusercontent.com/Anarios/return-to-fame/master/assets/empty.mp4"></video>

<script>
const socket=io();
let engineOn=false, voices=[];

// ‰øùÂ≠ò„Éá„Éº„Çø„ÅÆË™≠„ÅøËæº„Åø
window.onload = () => {
    const savedId = localStorage.getItem('mt_id');
    if(savedId) document.getElementById('targetId').value = savedId;
};

function loadVoices(){
    voices = window.speechSynthesis.getVoices().filter(v => v.lang.includes('ja'));
    const s = document.getElementById('voiceSelect');
    s.innerHTML = voices.map((v, i) => `<option value="${i}">${v.name}</option>`).join('');
}
window.speechSynthesis.onvoiceschanged = loadVoices; loadVoices();

function showTab(name){
    document.querySelectorAll('.tab-content').forEach(t=>t.classList.remove('active'));
    document.querySelectorAll('.side-icon').forEach(i=>i.classList.remove('active'));
    document.getElementById('tab-'+name).classList.add('active');
    document.getElementById('i-'+name).classList.add('active');
}

function toggleSettings(){
    const s = document.getElementById('settingsOverlay');
    s.style.display = (s.style.display === 'block') ? 'none' : 'block';
}

document.getElementById('audioStartBtn').addEventListener('click', function() {
    engineOn = true;
    this.style.background = "#333";
    this.innerText = "AUDIO RUNNING";
    document.getElementById('pip').play();
    speak("„Éû„ÉÉ„ÇØ„Éà„Éº„ÇØËµ∑Âãï„Åó„Åæ„Åó„Åü");
});

function applyAndConnect(){
    const id = document.getElementById('targetId').value.replace('@','');
    if(id) {
        localStorage.setItem('mt_id', id);
        socket.emit('setTarget', id);
        toggleSettings();
    }
}

socket.on('ev', e => {
    let msg = "";
    if(e.t==='chat') { msg = e.u + "„Åï„Çì„ÄÅ" + e.m; addLog("üí¨ " + e.u + ": " + e.m, "var(--accent)"); }
    if(e.t==='follow') { msg = document.getElementById('m-follow').value.replace('{user}', e.u); addLog("üë§ " + e.u + " Follow!", "#ffeb3b"); }
    if(e.t==='gift') { msg = document.getElementById('m-gift').value.replace('{user}',e.u).replace('{gift}',e.g); addLog("üéÅ " + e.u + " Gift!", "var(--pink)"); }
    if(engineOn) speak(msg);
});

socket.on('up-v', c => document.getElementById('vCount').innerText = c.toLocaleString());

function addLog(m, c){
    const d=document.createElement('div'); d.className='log-card';
    d.style.borderLeftColor=c; d.innerHTML=m;
    document.getElementById('eventLog').prepend(d);
}

function speak(t){
    if(!engineOn) return;
    window.speechSynthesis.cancel();
    const u=new SpeechSynthesisUtterance(t);
    const vIdx = document.getElementById('voiceSelect').value;
    if(voices[vIdx]) u.voice = voices[vIdx];
    u.rate = parseFloat(document.getElementById('v-speed').value);
    u.pitch = parseFloat(document.getElementById('v-pitch').value);
    window.speechSynthesis.speak(u);
}
</script>
</body>
</html>
