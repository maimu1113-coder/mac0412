<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
<title>TikFinity PRO Voice-Max</title>
<script src="/socket.io/socket.io.js"></script>
<style>
:root{--bg:#0b0e14;--side:#161920;--card:#1f232d;--accent:#00f2ea;--pink:#ff0050}
body{font-family:sans-serif;background:var(--bg);color:#fff;margin:0;display:flex;height:100vh;overflow:hidden}

/* TikFinity Sidebar */
.sidebar{width:60px;background:var(--side);display:flex;flex-direction:column;align-items:center;padding-top:40px;gap:30px;border-right:1px solid #2d323e}
.side-icon{font-size:1.5rem;opacity:0.4;cursor:pointer;transition:0.3s}
.side-icon.active{opacity:1;filter:drop-shadow(0 0 5px var(--accent))}

/* Main Container */
.main-content{flex:1;display:flex;flex-direction:column;padding:20px;position:relative}

/* Settings Overlay */
#settingsOverlay{position:absolute;top:0;left:0;width:100%;height:100%;background:var(--bg);z-index:10;display:none;padding:20px;box-sizing:border-box;overflow-y:auto}
.tab-content{display:none}
.tab-content.active{display:block}

/* Card Style */
.card{background:var(--card);border-radius:12px;padding:15px;margin-bottom:15px;border:1px solid #333}
.label{font-size:0.7rem;color:var(--accent);text-transform:uppercase;margin-bottom:8px;display:block;font-weight:bold}
input, select, textarea{width:100%;background:#0b0e14;border:1px solid #444;color:#fff;padding:12px;border-radius:8px;box-sizing:border-box}

/* Event Log */
#eventLog{flex:1;overflow-y:auto;display:flex;flex-direction:column-reverse;gap:10px}
.log-card{background:var(--card);padding:12px;border-radius:10px;font-size:0.85rem;border-left:4px solid #444;animation:slide 0.2s ease}
@keyframes slide{from{transform:translateX(-10px);opacity:0}to{transform:translateX(0);opacity:1}}

.btn-apply{background:var(--accent);color:#000;border:none;padding:18px;width:100%;border-radius:12px;font-weight:bold;font-size:1rem;margin-top:10px}
.btn-test{background:#333;color:#fff;border:none;padding:8px;border-radius:5px;font-size:0.7rem;margin-top:10px}
</style>
</head>
<body>

<div class="sidebar">
    <div id="i-main" onclick="showTab('main')" class="side-icon active">ğŸ </div>
    <div id="i-tts" onclick="showTab('tts')" class="side-icon">ğŸ¤</div>
    <div id="i-events" onclick="showTab('events')" class="side-icon">âš¡</div>
    <div onclick="toggleSettings()" class="side-icon">âš™ï¸</div>
</div>

<div class="main-content">
    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:15px">
        <div style="font-weight:900;font-size:1.4rem">Tik<span style="color:var(--pink)">Finity</span></div>
        <div style="background:#222;padding:5px 10px;border-radius:20px;font-size:0.7rem">LIVE: <span id="vCount">0</span></div>
    </div>

    <div id="eventLog"></div>

    <div id="settingsOverlay">
        <div style="display:flex;justify-content:space-between;margin-bottom:20px">
            <h2 id="tabTitle">MAIN SETTINGS</h2>
            <button onclick="toggleSettings()" style="background:none;border:none;color:#888;font-weight:bold">DONE</button>
        </div>

        <div id="tab-main" class="tab-content active">
            <div class="card">
                <label class="label">TikTok Username</label>
                <input type="text" id="targetId" placeholder="example: @lxxchipxxl">
            </div>
            <div class="card">
                <label class="label">System Audio Control</label>
                <button id="audioStartBtn" class="btn-apply" style="background:var(--pink);color:#fff">âš¡ ACTIVATE AUDIO ENGINE</button>
            </div>
            <button class="btn-apply" onclick="applyAndConnect()">SAVE & CONNECT</button>
        </div>

        <div id="tab-tts" class="tab-content">
            <div class="card">
                <label class="label">Voice Selection (å¤šæ•°ã®å£°ã‹ã‚‰é¸æŠ)</label>
                <select id="voiceSelect"></select>
                <button class="btn-test" onclick="speak('ã“ã‚Œã¯ãƒ†ã‚¹ãƒˆéŸ³å£°ã§ã™ã€‚ã©ã†ã§ã™ã‹ï¼Ÿ')">â–¶ è©¦ã—èãã™ã‚‹</button>
            </div>
            <div class="card">
                <label class="label">Voice Pitch (å£°ã®é«˜ã•)</label>
                <input type="range" id="v-pitch" min="0.5" max="2.0" step="0.1" value="1.0">
            </div>
            <div class="card">
                <label class="label">Voice Speed (é€Ÿã•)</label>
                <input type="range" id="v-speed" min="0.5" max="2.0" step="0.1" value="1.2">
            </div>
        </div>

        <div id="tab-events" class="tab-content">
            <div class="card">
                <label class="label">Follow Welcome Message</label>
                <textarea id="m-follow">{user}ã•ã‚“ã€ãƒ•ã‚©ãƒ­ãƒ¼ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã™ï¼</textarea>
            </div>
            <div class="card">
                <label class="label">Gift Thank-you Message</label>
                <textarea id="m-gift">{user}ã•ã‚“ã€{gift}ã‚ã‚ŠãŒã¨ã†ï¼</textarea>
            </div>
        </div>
    </div>
</div>

<video id="pip" playsinline muted loop style="display:none"><source src="https://raw.githubusercontent.com/Anarios/return-to-fame/master/assets/empty.mp4"></video>

<script>
const socket=io();
let engineOn=false, voices=[];

// --- å£°ã®èª­ã¿è¾¼ã¿ ---
function loadVoices(){
    voices = window.speechSynthesis.getVoices().filter(v => v.lang.includes('ja') || v.lang.includes('JP'));
    const select = document.getElementById('voiceSelect');
    select.innerHTML = voices.map((v, i) => `<option value="${i}">${v.name}</option>`).join('');
}
window.speechSynthesis.onvoiceschanged = loadVoices;
loadVoices();

// --- ã‚¿ãƒ–åˆ‡ã‚Šæ›¿ãˆ ---
function showTab(name){
    document.querySelectorAll('.tab-content').forEach(t=>t.classList.remove('active'));
    document.querySelectorAll('.side-icon').forEach(i=>i.classList.remove('active'));
    document.getElementById('tab-'+name).classList.add('active');
    document.getElementById('i-'+name).classList.add('active');
    document.getElementById('tabTitle').innerText = name.toUpperCase() + " SETTINGS";
}

function toggleSettings(){
    const s = document.getElementById('settingsOverlay');
    s.style.display = (s.style.display === 'block') ? 'none' : 'block';
}

// --- éŸ³å£°ã‚¨ãƒ³ã‚¸ãƒ³ã®æœ‰åŠ¹åŒ– ---
document.getElementById('audioStartBtn').onclick = function() {
    engineOn = true;
    this.style.background = "#333";
    this.innerText = "AUDIO ENGINE RUNNING";
    document.getElementById('pip').play();
    speak("èª­ã¿ä¸Šã’ã‚¨ãƒ³ã‚¸ãƒ³ãŒæ­£å¸¸ã«èµ·å‹•ã—ã¾ã—ãŸã€‚");
};

function applyAndConnect(){
    const id = document.getElementById('targetId').value;
    if(id) {
        socket.emit('setTarget', id.replace('@',''));
        toggleSettings();
        addLog("System: " + id + " ã«æ¥ç¶šè©¦è¡Œä¸­...", "#888");
    }
}

// --- ã‚¤ãƒ™ãƒ³ãƒˆå—ä¿¡ ---
socket.on('ev', e => {
    let msg = "";
    if(e.t==='chat') { msg = e.u + "ã•ã‚“ã€" + e.m; addLog("ğŸ’¬ " + e.u + ": " + e.m, var(--accent)); }
    if(e.t==='follow') { msg = document.getElementById('m-follow').value.replace('{user}', e.u); addLog("ğŸ‘¤ " + e.u + " ãŒãƒ•ã‚©ãƒ­ãƒ¼ï¼", "#ffeb3b"); }
    if(e.t==='gift') { msg = document.getElementById('m-gift').value.replace('{user}',e.u).replace('{gift}',e.g); addLog("ğŸ " + e.u + " ã‹ã‚‰ " + e.g, var(--pink)); }
    if(engineOn) speak(msg);
});

socket.on('up-v', c => document.getElementById('vCount').innerText = c.toLocaleString());

function addLog(m, c){
    const d=document.createElement('div'); d.className='log-card';
    d.style.borderLeftColor=c; d.innerHTML=m;
    document.getElementById('eventLog').prepend(d);
}

// --- èª­ã¿ä¸Šã’æœ¬ä½“ ---
function speak(t){
    if(!engineOn) return;
    window.speechSynthesis.cancel(); // å‰ã®éŸ³å£°ã‚’æ­¢ã‚ã¦æœ€æ–°ã‚’å„ªå…ˆï¼ˆTikFinityé¢¨ï¼‰
    const u=new SpeechSynthesisUtterance(t);
    const vIdx = document.getElementById('voiceSelect').value;
    if(voices[vIdx]) u.voice = voices[vIdx];
    u.rate = parseFloat(document.getElementById('v-speed').value);
    u.pitch = parseFloat(document.getElementById('v-pitch').value);
    window.speechSynthesis.speak(u);
}
</script>
</body>
</html>
