<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0,viewport-fit=cover">
<title>Mac Talk PRO</title>
<script src="/socket.io/socket.io.js"></script>

<style>
:root {
  --bg:#0b0e14;
  --side:#161920;
  --card:#1f232d;
  --accent:#00f2ea;
  --pink:#ff0050;
}

body {
  margin:0;
  height:100vh;
  overflow:hidden;
  display:flex;
  background:var(--bg);
  color:#fff;
  font-family:sans-serif;
}

.sidebar {
  width:60px;
  background:var(--side);
  display:flex;
  flex-direction:column;
  align-items:center;
  padding-top:30px;
  gap:35px;
}

.side-btn {
  font-size:1.5rem;
  cursor:pointer;
  opacity:.6;
}

.main {
  flex:1;
  display:flex;
  flex-direction:column;
  padding:12px;
  overflow:hidden;
}

.card {
  background:var(--card);
  border-radius:12px;
  padding:12px;
  margin-bottom:10px;
}

input {
  width:100%;
  padding:14px;
  border-radius:8px;
  background:#000;
  border:1px solid #555;
  color:#fff;
  font-size:16px;
  margin-bottom:10px;
}

button {
  width:100%;
  padding:14px;
  border:none;
  border-radius:10px;
  font-weight:bold;
  margin-bottom:8px;
  cursor:pointer;
}

.btn-pink { background:var(--pink); color:#fff; }
.btn-blue { background:var(--accent); color:#000; }

#streamer {
  display:none;
  align-items:center;
  gap:10px;
  margin-bottom:10px;
}

#streamer img {
  width:46px;
  height:46px;
  border-radius:50%;
}

.badge {
  background:red;
  padding:2px 6px;
  border-radius:6px;
  font-size:0.7rem;
  margin-left:6px;
}

#stats {
  display:flex;
  gap:12px;
  font-size:0.8rem;
  opacity:.9;
}

#log-area {
  flex:1;
  overflow-y:auto;
  background:rgba(255,255,255,0.02);
  border-radius:10px;
  padding:10px;
  display:flex;
  flex-direction:column;
  gap:8px;
}

.log-item {
  background:var(--card);
  padding:10px;
  border-radius:8px;
  border-left:4px solid var(--accent);
  font-size:0.85rem;
}
</style>
</head>

<body>

<div class="sidebar">
  <div class="side-btn" onclick="location.reload()">üè†</div>
  <div class="side-btn" onclick="status()">üé§</div>
  <div class="side-btn" onclick="status()">‚öôÔ∏è</div>
</div>

<div class="main">

<h2>Mac Talk <span style="color:var(--accent)">PRO</span></h2>

<div id="streamer">
  <img id="avatar">
  <div>
    <div><strong id="name"></strong><span class="badge">LIVE</span></div>
    <div id="stats">
      <div>üë• <span id="followers">0</span></div>
      <div>‚ù§Ô∏è <span id="likes">0</span></div>
    </div>
  </div>
</div>

<div class="card">
  <input id="tid" placeholder="TikTok ID (@„Å™„Åó)">
  <button class="btn-pink" onclick="startVoice()">1. Ë™≠„Åø‰∏ä„ÅíON</button>
  <button class="btn-blue" onclick="connect()">2. Êé•Á∂ö</button>
</div>

<div id="log-area">
  <div class="log-item">„É≠„Ç∞ÂæÖÊ©ü‰∏≠...</div>
</div>

</div>

<script>
const socket = io();
let voiceOn=false, talking=false, queue=[];

function log(m){
  const d=document.createElement("div");
  d.className="log-item";
  d.innerText=m;
  document.getElementById("log-area").prepend(d);
}

function startVoice(){
  voiceOn=true;
  log("üé§ Ë™≠„Åø‰∏ä„ÅíON");
}

function connect(){
  const id=document.getElementById("tid").value.trim();
  if(!id) return alert("ID„ÇíÂÖ•Âäõ");
  socket.emit("setTarget", id.replace("@",""));
  log("‚è≥ Êé•Á∂ö‰∏≠...");
}

socket.on("streamer", d=>{
  document.getElementById("streamer").style.display="flex";
  avatar.src=d.avatar;
  name.innerText=d.nickname+" (@"+d.uniqueId+")";
  followers.innerText=d.followers;
  likes.innerText=d.likes;
});

socket.on("up-follow", n=>followers.innerText=n);
socket.on("up-like", n=>likes.innerText=n);

socket.on("ev", e=>{
  if(e.t==="chat"){
    log("üí¨ "+e.u+": "+e.m);
    speak(e.u+"„Åï„Çì "+e.m);
  }
  if(e.t==="follow") log("üë§ "+e.u+" „Éï„Ç©„É≠„ÉºÔºÅ");
  if(e.t==="sys") log(e.m);
});

function speak(t){
  if(!voiceOn) return;
  queue.push(t);
  if(talking) return;
  talking=true;
  const u=new SpeechSynthesisUtterance(queue.shift());
  u.lang="ja-JP";
  u.onend=()=>{ talking=false; if(queue.length) speak(queue.shift()); };
  speechSynthesis.speak(u);
}
</script>

</body>
</html>
