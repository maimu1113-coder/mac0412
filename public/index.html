<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0,viewport-fit=cover">
<title>Mac Talk PRO</title>
<script src="/socket.io/socket.io.js"></script>

<style>
:root {
  --bg:#0b0e14;
  --side:#161920;
  --card:#1f232d;
  --accent:#00f2ea;
  --pink:#ff0050;
}
body {
  margin:0;
  height:100vh;
  display:flex;
  background:var(--bg);
  color:#fff;
  font-family:sans-serif;
  overflow:hidden;
}
.sidebar {
  width:60px;
  background:var(--side);
  display:flex;
  flex-direction:column;
  align-items:center;
  padding-top:30px;
  gap:35px;
  border-right:1px solid #333;
}
.side-btn {
  font-size:1.5rem;
  cursor:pointer;
  opacity:0.6;
}
.main {
  flex:1;
  padding:15px;
  display:flex;
  flex-direction:column;
  overflow:hidden;
}
.card {
  background:var(--card);
  padding:15px;
  border-radius:12px;
  margin-bottom:10px;
  border:1px solid #444;
}
input {
  width:100%;
  padding:15px;
  font-size:18px;
  background:#000;
  color:#fff;
  border:1px solid #555;
  border-radius:8px;
  margin-bottom:12px;
}
button {
  width:100%;
  padding:16px;
  font-size:16px;
  border-radius:10px;
  border:none;
  cursor:pointer;
  margin-bottom:10px;
}
.btn-pink { background:var(--pink); color:#fff; }
.btn-blue { background:var(--accent); color:#000; }

#log-area {
  flex:1;
  overflow-y:auto;
  display:flex;
  flex-direction:column;
  gap:8px;
}
.log-item {
  background:var(--card);
  padding:12px;
  border-radius:8px;
  border-left:4px solid var(--accent);
}
</style>
</head>

<body>

<div class="sidebar">
  <div class="side-btn" onclick="location.reload()">ğŸ </div>
  <div class="side-btn" onclick="checkStatus('mic')">ğŸ¤</div>
  <div class="side-btn" onclick="checkStatus('sys')">âš™ï¸</div>
</div>

<div class="main">

  <!-- ğŸ”¥ LIVEé…ä¿¡è€…ãƒ˜ãƒƒãƒ€ãƒ¼ -->
  <div id="liveHeader" class="card" style="display:none">
    <div style="display:flex;gap:12px;align-items:center">
      <img id="avatar" style="width:64px;height:64px;border-radius:50%;border:2px solid var(--accent)">
      <div>
        <div style="font-weight:bold;font-size:1.1rem">
          <span id="nickname"></span>
          <span style="background:#ff0050;color:#fff;font-size:0.7rem;
            padding:2px 8px;border-radius:10px;margin-left:6px">LIVE</span>
        </div>
        <div style="opacity:0.7">@<span id="uid"></span></div>
        <div style="font-size:0.8rem;opacity:0.8">
          ğŸ‘¥ <span id="followers"></span> ï½œ â¤ï¸ <span id="likes"></span>
        </div>
      </div>
    </div>
  </div>

  <div class="card">
    <input id="tid" placeholder="TikTok ID (@ãªã—)">
    <button class="btn-pink" onclick="startVoice()">1. èª­ã¿ä¸Šã’ã‚’æœ‰åŠ¹</button>
    <button class="btn-blue" onclick="connect()">2. ä¿å­˜ã—ã¦ãƒ©ã‚¤ãƒ–æ¥ç¶š</button>
  </div>

  <div id="log-area">
    <div class="log-item">ãƒ­ã‚°å¾…æ©Ÿä¸­...</div>
  </div>

</div>

<audio id="silent" loop playsinline
src="https://raw.githubusercontent.com/anars/blank-audio/master/10-seconds-of-silence.mp3"></audio>

<script>
const socket = io();
let engineOn=false, talking=false, queue=[];
let timer=null, sec=0, currentLog=null;

function addLog(msg, update=false){
  const area=document.getElementById("log-area");
  if(update && currentLog){ currentLog.innerText=msg; return; }
  const d=document.createElement("div");
  d.className="log-item"; d.innerText=msg;
  area.insertBefore(d, area.firstChild);
  currentLog=d;
}

function startVoice(){
  engineOn=true;
  document.getElementById("silent").play();
  const u=new SpeechSynthesisUtterance("èª­ã¿ä¸Šã’ã‚’é–‹å§‹ã—ã¾ã™");
  u.lang="ja-JP"; speechSynthesis.speak(u);
  addLog("âœ… éŸ³å£°ã‚¨ãƒ³ã‚¸ãƒ³èµ·å‹•");
}

function connect(){
  const id=document.getElementById("tid").value.replace("@","").trim();
  if(!id) return alert("IDã‚’å…¥åŠ›");
  sec=0;
  if(timer) clearInterval(timer);
  addLog("â³ æ¥ç¶šè©¦è¡Œä¸­... 0.0ç§’");
  timer=setInterval(()=>{
    sec+=0.1;
    addLog(`â³ æ¥ç¶šè©¦è¡Œä¸­... ${sec.toFixed(1)}ç§’`, true);
  },100);
  socket.emit("setTarget",id);
}

socket.on("ev",e=>{
  if(e.t==="profile"){
    document.getElementById("liveHeader").style.display="block";
    avatar.src=e.avatar;
    nickname.innerText=e.nickname;
    uid.innerText=e.uid;
    followers.innerText=e.followers.toLocaleString();
    likes.innerText=e.likes.toLocaleString();
  }
  if(e.t==="sys"){
    clearInterval(timer);
    addLog(`ğŸ“¢ ${e.m} (${sec.toFixed(1)}ç§’)`);
  }
  if(e.t==="chat"){
    addLog(`ğŸ’¬ ${e.u}: ${e.m}`);
    if(engineOn){ queue.push(`${e.u}ã•ã‚“ ${e.m}`); talk(); }
  }
});

function talk(){
  if(!engineOn||talking||!queue.length) return;
  talking=true;
  const u=new SpeechSynthesisUtterance(queue.shift());
  u.lang="ja-JP"; u.rate=1.2;
  u.onend=()=>{ talking=false; talk(); };
  speechSynthesis.speak(u);
}
</script>

</body>
</html>
