<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>MacTok Engine PRO</title>
<style>
  body { margin: 0; background: #000; color: #fff; font-family: sans-serif; display: flex; align-items: center; justify-content: center; min-height: 100vh; }
  .card { background: #111; border-radius: 20px; padding: 30px; width: 90%; max-width: 360px; text-align: center; box-shadow: 0 0 30px rgba(255,0,80,0.4); }
  .title { font-size: 28px; font-weight: bold; margin-bottom: 5px; }
  .subtitle { font-size: 14px; color: #888; margin-bottom: 25px; }
  input { width: 100%; padding: 15px; margin-bottom: 20px; border-radius: 12px; border: 1px solid #333; background: #1a1a1a; color: #fff; font-size: 16px; text-align: center; box-sizing: border-box; }
  button { width: 100%; padding: 15px; border-radius: 30px; border: none; background: #ff0050; color: #fff; font-size: 18px; font-weight: bold; cursor: pointer; }
  #result-area { margin-top: 20px; padding: 15px; background: #222; border-radius: 12px; display: none; text-align: left; }
  .avatar { width: 60px; height: 60px; border-radius: 50%; border: 2px solid #ff0050; display: block; margin: 0 auto 10px; }
  .user-name { text-align: center; font-weight: bold; margin-bottom: 10px; color: #ff0050; }
  .stat-item { font-size: 14px; border-bottom: 1px solid #333; padding: 5px 0; display: flex; justify-content: space-between; }
  #server-status { margin-top: 20px; font-size: 12px; color: #666; }
</style>
</head>
<body>

<div class="card">
  <div class="title">MacTok <span style="color:#ff0050;">PRO</span></div>
  <div class="subtitle">Mobile Engine</div>

  <input type="text" id="tiktok-id" placeholder="TikTok IDï¼ˆä¾‹: macdonaldï¼‰">
  <button id="main-btn" onclick="fetchTikTokData()">æº–å‚™å®Œäº†</button>

  <div id="result-area">
    <img id="user-avatar" class="avatar" src="" alt="">
    <div id="user-nickname" class="user-name"></div>
    <div class="stat-item"><span>ãƒ•ã‚©ãƒ­ãƒ¯ãƒ¼</span><span id="stat-followers"></span></div>
    <div class="stat-item"><span>ã„ã„ã­</span><span id="stat-hearts"></span></div>
    <div class="stat-item"><span>å‹•ç”»æ•°</span><span id="stat-videos"></span></div>
  </div>

  <div id="server-status">ğŸ”„ ã‚µãƒ¼ãƒãƒ¼ç¢ºèªä¸­...</div>
</div>

<script>
async function fetchTikTokData() {
  const id = document.getElementById("tiktok-id").value.trim();
  const btn = document.getElementById("main-btn");
  const resultArea = document.getElementById("result-area");
  const statusEl = document.getElementById("server-status");

  if (!id) { alert("IDã‚’å…¥åŠ›ã—ã¦ãã ã•ã„"); return; }

  btn.disabled = true;
  btn.innerText = "èª­ã¿è¾¼ã¿ä¸­...";
  statusEl.innerText = "ğŸ” TikTokãƒ‡ãƒ¼ã‚¿ã‚’æ¤œç´¢ä¸­...";

  try {
    const res = await fetch(`/api/tiktok/${id}`);
    const data = await res.json();

    if (data.error) {
      alert("ã‚¨ãƒ©ãƒ¼: " + data.error);
    } else {
      // ç”»é¢ã«ãƒ‡ãƒ¼ã‚¿ã‚’åæ˜ 
      document.getElementById("user-avatar").src = data.user.avatarThumb;
      document.getElementById("user-nickname").innerText = data.user.nickname;
      document.getElementById("stat-followers").innerText = data.stats.followerCount.toLocaleString();
      document.getElementById("stat-hearts").innerText = data.stats.heartCount.toLocaleString();
      document.getElementById("stat-videos").innerText = data.stats.videoCount.toLocaleString();
      
      resultArea.style.display = "block";
      statusEl.innerText = "âœ… ãƒ‡ãƒ¼ã‚¿ã®èª­ã¿è¾¼ã¿ã«æˆåŠŸã—ã¾ã—ãŸ";
    }
  } catch (e) {
    alert("ã‚µãƒ¼ãƒãƒ¼ã¨ã®é€šä¿¡ã«å¤±æ•—ã—ã¾ã—ãŸ");
  } finally {
    btn.disabled = false;
    btn.innerText = "æº–å‚™å®Œäº†";
  }
}

async function checkStatus() {
  const el = document.getElementById("server-status");
  try {
    const res = await fetch("/health");
    if (res.ok) el.innerHTML = "ğŸŸ¢ Server : ONLINE";
  } catch (e) { el.innerHTML = "ğŸ”´ Server : OFFLINE"; }
}
checkStatus();
</script>

</body>
</html>
