<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>MacTok PRO</title>
<script src="/socket.io/socket.io.js"></script>
<style>
  body { margin: 0; background: #000; color: #fff; font-family: sans-serif; display: flex; align-items: center; justify-content: center; min-height: 100vh; overflow: hidden; }
  .card { background: #111; border-radius: 30px; padding: 30px; width: 90%; max-width: 380px; text-align: center; border: 1px solid #333; box-shadow: 0 0 50px rgba(255,0,80,0.2); }
  input { width: 100%; padding: 18px; margin-bottom: 20px; border-radius: 15px; border: 1px solid #444; background: #000; color: #fff; text-align: center; font-size: 18px; outline: none; }
  button { width: 100%; padding: 18px; border-radius: 40px; border: none; background: linear-gradient(45deg, #ff0050, #00f2ea); color: #fff; font-size: 20px; font-weight: bold; cursor: pointer; transition: 0.3s; }
  button:hover { transform: scale(1.05); opacity: 0.9; }
  #comment-box { height: 300px; overflow-y: auto; background: #050505; border-radius: 15px; padding: 15px; text-align: left; font-size: 15px; margin-top: 25px; border: 1px solid #222; }
  .comment { margin-bottom: 12px; border-bottom: 1px solid #111; padding-bottom: 8px; animation: slideIn 0.3s ease-out; }
  @keyframes slideIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
  .user { color: #00f2ea; font-weight: bold; font-size: 12px; }
  #status-label { font-size: 13px; color: #888; margin-top: 20px; display: block; }
</style>
</head>
<body>
<div class="card">
  <div style="font-size: 26px; font-weight: bold; margin-bottom: 25px;">MacTok <span style="color:#ff0050;">PRO</span></div>
  <input type="text" id="tiktok-id" placeholder="配信者ID (@なし)">
  <button onclick="start()">エンジン始動</button>
  <div id="comment-box">コメント待機中...</div>
  <span id="status-label">Ready</span>
</div>

<script>
const socket = io({ transports: ["polling"] });
const synth = window.speechSynthesis;

function speak(text) {
    const utter = new SpeechSynthesisUtterance(text);
    utter.lang = 'ja-JP';
    utter.rate = 1.3;
    synth.speak(utter);
}

function start() {
    const id = document.getElementById("tiktok-id").value.trim();
    if (!id) return;

    // 音声制限を強制解除（無音を再生）
    speak(" "); 
    
    document.getElementById("status-label").innerText = "⏳ 接続を開始しています...";
    document.getElementById("comment-box").innerText = "接続中...";
    socket.emit("connect-live", id);
}

socket.on("new-comment", (data) => {
    const box = document.getElementById("comment-box");
    if (box.innerText.includes("接続中")) box.innerHTML = "";
    
    const el = document.createElement("div");
    el.className = "comment";
    el.innerHTML = `<span class="user">@${data.user}</span><br>${data.text}`;
    box.prepend(el);
    
    speak(data.text);
});

socket.on("live-status", (msg) => {
    document.getElementById("status-label").innerText = msg;
});
</script>
</body>
</html>
