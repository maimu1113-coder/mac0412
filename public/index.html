<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0,viewport-fit=cover">
<title>Mac Talk PRO Control</title>
<script src="/socket.io/socket.io.js"></script>
<style>
:root{--bg:#0b0e14;--side:#161920;--card:#1f232d;--accent:#00f2ea;--pink:#ff0050}
body{font-family:sans-serif;background:var(--bg);color:#fff;margin:0;display:flex;height:100vh;overflow:hidden}
/* ã‚µã‚¤ãƒ‰ãƒãƒ¼å›ºå®š */
.sidebar{width:60px;min-width:60px;background:var(--side);display:flex;flex-direction:column;align-items:center;padding-top:30px;gap:25px;border-right:1px solid #333;z-index:10}
/* ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ */
.main{flex:1;padding:20px;display:flex;flex-direction:column;height:100vh;box-sizing:border-box}
.card{background:var(--card);padding:15px;border-radius:12px;margin-bottom:15px;border:1px solid #444}
input{width:100%;padding:12px;background:#000;border:1px solid #555;color:#fff;border-radius:8px;box-sizing:border-box;font-size:16px;margin-bottom:10px}
button{width:100%;padding:15px;border-radius:10px;border:none;font-weight:bold;cursor:pointer;margin-bottom:10px}
.btn-pink{background:var(--pink);color:#fff}
.btn-blue{background:var(--accent);color:#000}
/* ãƒ­ã‚°ã‚¨ãƒªã‚¢ï¼šã“ã“ãŒé‡è¦ */
#log-container{flex:1;overflow-y:auto;display:flex;flex-direction:column;gap:8px;padding-bottom:20px}
.log-item{background:#252a35;padding:12px;border-radius:8px;border-left:4px solid var(--accent);word-break:break-all;animation: slideIn 0.3s ease-out}
@keyframes slideIn { from{opacity:0;transform:translateX(10px)} to{opacity:1;transform:translateX(0)} }
</style>
</head>
<body>
<div class="sidebar"><div>ğŸ </div><div>ğŸ¤</div><div>âš™ï¸</div></div>
<div class="main">
    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:15px">
        <h2 style="margin:0">Mac Talk <span style="color:var(--accent)">PRO</span></h2>
        <div style="background:#222;padding:4px 10px;border-radius:15px;font-size:0.75rem">ğŸ‘ï¸ <span id="vCount">0</span></div>
    </div>
    
    <div class="card">
        <input id="tid" placeholder="TikTok ID (@ãªã—)">
        <button class="btn-pink" onclick="startAudio()">1. èª­ã¿ä¸Šã’ã‚’æœ‰åŠ¹ã«ã™ã‚‹</button>
        <button class="btn-blue" onclick="connect()">2. ä¿å­˜ã—ã¦ãƒ©ã‚¤ãƒ–æ¥ç¶š</button>
    </div>

    <div id="log-container"></div>
</div>

<video id="pip" muted loop playsinline style="display:none"><source src="https://raw.githubusercontent.com/Anarios/return-to-fame/master/assets/empty.mp4"></video>

<script>
const socket=io();
let engine=false, queue=[], talking=false, lastEv=Date.now();
const logContainer = document.getElementById("log-container");

function startAudio(){
    engine=true;
    const u=new SpeechSynthesisUtterance("èª­ã¿ä¸Šã’ã‚’é–‹å§‹ã—ã¾ã™");
    u.lang='ja-JP'; window.speechSynthesis.speak(u);
    document.getElementById("pip").play();
}

function connect(){
    const id=document.getElementById("tid").value.trim();
    if(id){ socket.emit("setTarget", id); localStorage.setItem("mtid", id); }
}

window.onload=()=>{ if(localStorage.getItem("mtid")) document.getElementById("tid").value=localStorage.getItem("mtid"); };

socket.on("ev", e => {
    lastEv = Date.now();
    let textForSpeech = "";
    let textForLog = "";

    if(e.t==="chat") {
        textForSpeech = `${e.u}ã•ã‚“ã€${e.m}`;
        textForLog = `ğŸ’¬ ${e.u}: ${e.m}`;
    }
    if(e.t==="follow") {
        textForSpeech = `${e.u}ã•ã‚“ãƒ•ã‚©ãƒ­ãƒ¼ã‚ã‚ŠãŒã¨ã†`;
        textForLog = `ğŸ‘¤ ${e.u} ãŒãƒ•ã‚©ãƒ­ãƒ¼ã—ã¾ã—ãŸ`;
    }
    if(e.t==="gift") {
        textForSpeech = `${e.u}ã•ã‚“ã€${e.g}ã‚ã‚ŠãŒã¨ã†`;
        textForLog = `ğŸ ${e.u}: ${e.g} x${e.c}`;
    }
    if(e.t==="sys") {
        textForLog = `ğŸ“¢ ${e.m}`;
    }

    if(textForLog) addLog(textForLog);
    if(textForSpeech) { queue.push(textForSpeech); speak(); }
});

socket.on("up-v", c => document.getElementById("vCount").innerText = c);

function speak(){
    if(!engine || talking || queue.length===0) return;
    talking=true;
    const u=new SpeechSynthesisUtterance(queue.shift());
    u.lang='ja-JP'; u.rate=1.2;
    u.onend=()=>{ talking=false; speak(); };
    window.speechSynthesis.speak(u);
}

function addLog(m){
    const d=document.createElement("div");
    d.className="log-item";
    d.innerText=m;
    // æœ€æ–°ã®ã‚³ãƒ¡ãƒ³ãƒˆã‚’ä¸€ç•ªä¸Šã«è¿½åŠ 
    logContainer.insertBefore(d, logContainer.firstChild);
}
</script>
</body>
</html>
