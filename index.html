<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MacTok Pro üöÄ</title>
    <script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
    <style>
        body { font-family: -apple-system, sans-serif; background: #000; color: white; padding: 20px; }
        .container { max-width: 500px; margin: 0 auto; }
        #log { height: 60vh; overflow-y: auto; border: 1px solid #333; padding: 10px; background: #111; margin-top: 15px; border-radius: 12px; }
        .comment { margin-bottom: 8px; animation: fadeIn 0.3s; line-height: 1.4; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }
        .user { color: #00f2ea; font-weight: bold; font-size: 0.9em; }
        .text { color: #fff; margin-left: 5px; }
        .status { padding: 12px; margin-bottom: 15px; border-radius: 8px; font-weight: bold; text-align: center; font-size: 0.9em; }
        .waiting { background: #222; color: #aaa; }
        .connected { background: #00f2ea; color: #000; }
        .error { background: #ff0050; color: #fff; }
        .input-group { display: flex; gap: 10px; }
        input { flex: 1; padding: 12px; border-radius: 8px; border: 1px solid #444; background: #222; color: white; outline: none; }
        button { padding: 12px 20px; background: #ff0050; color: white; border: none; border-radius: 8px; font-weight: bold; }
    </style>
</head>
<body>
    <div class="container">
        <h2 style="text-align: center;">MacTok Pro üöÄ</h2>
        
        <div id="statusLabel" class="status waiting">TikTok ID„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ</div>

        <div class="input-group">
            <input type="text" id="targetId" placeholder="„É¶„Éº„Ç∂„ÉºÂêç (@„Å™„Åó)">
            <button onclick="connect()">ÈñãÂßã</button>
        </div>

        <div id="log"></div>
    </div>

    <script>
        /* ===== Ë®≠ÂÆö ===== */
        // Render„ÅÆ„ÄåLive„ÄçÁîªÈù¢„Å´Ë°®Á§∫„Åï„Çå„Å¶„ÅÑ„Çã„ÅÇ„Å™„Åü„ÅÆURL„Åß„Åô
        const WS_URL = "wss://mactok-engine.onrender.com"; 
        
        let socket;

        function connect() {
            const targetId = document.getElementById('targetId').value.trim();
            if (!targetId) return alert('TikTok ID„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ');

            const statusLabel = document.getElementById('statusLabel');
            const log = document.getElementById('log');
            
            // ‰ª•Ââç„ÅÆÊé•Á∂ö„Åå„ÅÇ„Çå„Å∞ÂàáÊñ≠
            if (socket) socket.disconnect();

            statusLabel.innerText = "„Çµ„Éº„Éê„Éº„Å´Êé•Á∂ö‰∏≠...";
            statusLabel.className = "status waiting";
            log.innerHTML = ""; // „É≠„Ç∞„Çí„ÇØ„É™„Ç¢

            // Render„Çµ„Éº„Éê„Éº„Å´Êé•Á∂ö
            socket = io(WS_URL);

            socket.on('connect', () => {
                statusLabel.innerText = `${targetId} „ÅÆ„É©„Ç§„Éñ„ÇíÊé¢„Åó„Å¶„ÅÑ„Åæ„Åô...`;
                // TikTok„ÅÆÂèñÂæó„ÇíÈñãÂßã
                socket.emit('start', targetId);
            });

            socket.on('status', (status) => {
                if (status === 'connected') {
                    statusLabel.innerText = "üü¢ TikTok„É©„Ç§„Éñ„Å´Êé•Á∂ö‰∏≠ÔºÅ";
                    statusLabel.className = "status connected";
                } else {
                    statusLabel.innerText = "‚ùå Â§±ÊïóÔºöÈÖç‰ø°‰∏≠„Åß„ÅØ„Å™„ÅÑ„ÅãID„ÅåÈÅï„ÅÑ„Åæ„Åô";
                    statusLabel.className = "status error";
                }
            });

            // „ÉÅ„É£„ÉÉ„ÉàÂèó‰ø°
            socket.on('chat', (data) => {
                const div = document.createElement('div');
                div.className = "comment";
                div.innerHTML = `<span class="user">${data.user}:</span><span class="text">${data.text}</span>`;
                log.prepend(div);
            });

            // „ÇÆ„Éï„ÉàÂèó‰ø°
            socket.on('gift', (data) => {
                const div = document.createElement('div');
                div.className = "comment";
                div.style.color = "#ffea00";
                div.style.fontWeight = "bold";
                div.innerHTML = `üéÅ ${data.user}„Åï„Çì„Åå„Äå${data.gift}„Äç„ÇíË¥à„Çä„Åæ„Åó„ÅüÔºÅ`;
                log.prepend(div);
            });

            socket.on('connect_error', () => {
                statusLabel.innerText = "‚ùå „Çµ„Éº„Éê„ÉºÊé•Á∂ö„Ç®„É©„Éº";
                statusLabel.className = "status error";
            });
        }
    </script>
</body>
</html>
