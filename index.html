<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MacTok Pro - TikTok Live Monitor</title>
    <script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
    <style>
        body { font-family: sans-serif; background: #121212; color: white; padding: 20px; }
        #log { height: 400px; overflow-y: auto; border: 1px solid #444; padding: 10px; background: #000; margin-top: 10px; border-radius: 8px; }
        .comment { margin-bottom: 5px; border-bottom: 1px solid #222; padding-bottom: 3px; }
        .user { color: #ff0050; font-weight: bold; }
        .text { color: #fff; }
        .status { padding: 10px; margin-bottom: 10px; border-radius: 5px; font-weight: bold; }
        .connected { background: #00f2ea; color: black; }
        .error { background: #ff0050; color: white; }
        input { padding: 10px; width: 60%; border-radius: 5px; border: none; }
        button { padding: 10px; background: #ff0050; color: white; border: none; border-radius: 5px; cursor: pointer; }
    </style>
</head>
<body>

    <h2>MacTok Pro ğŸš€</h2>
    
    <div id="statusLabel" class="status" style="background: #333;">TikTok IDã‚’å…¥åŠ›ã—ã¦æ¥ç¶šã—ã¦ãã ã•ã„</div>

    <input type="text" id="targetId" placeholder="TikTok ID (@ãªã—)">
    <button onclick="connect()">æ¥ç¶šã™ã‚‹</button>

    <div id="log"></div>

    <script>
        /* ===== è¨­å®š ===== */
        // Renderã§ä½œæˆã—ãŸã‚ãªãŸã®ã‚µãƒ¼ãƒãƒ¼ã®ä½æ‰€
        const WS_URL = "wss://mactok-engine.onrender.com"; 
        
        let socket;

        function connect() {
            const targetId = document.getElementById('targetId').value;
            if (!targetId) return alert('TikTok IDã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');

            const statusLabel = document.getElementById('statusLabel');
            const log = document.getElementById('log');
            
            statusLabel.innerText = "æ¥ç¶šä¸­...";
            statusLabel.style.background = "#555";

            // ã‚µãƒ¼ãƒãƒ¼ã«æ¥ç¶š
            socket = io(WS_URL);

            socket.on('connect', () => {
                console.log('Server connected');
                // TikTokã®å–å¾—ã‚’é–‹å§‹
                socket.emit('start', targetId);
            });

            socket.on('status', (status) => {
                if (status === 'connected') {
                    statusLabel.innerText = "ğŸŸ¢ TikTokã«æ¥ç¶šæˆåŠŸï¼";
                    statusLabel.className = "status connected";
                } else {
                    statusLabel.innerText = "âŒ æ¥ç¶šã‚¨ãƒ©ãƒ¼ï¼ˆé…ä¿¡ä¸­ã‹ç¢ºèªã—ã¦ãã ã•ã„ï¼‰";
                    statusLabel.className = "status error";
                }
            });

            // ãƒãƒ£ãƒƒãƒˆå—ä¿¡
            socket.on('chat', (data) => {
                const div = document.createElement('div');
                div.className = "comment";
                div.innerHTML = `<span class="user">${data.user}:</span> <span class="text">${data.text}</span>`;
                log.prepend(div);
            });

            // ã‚®ãƒ•ãƒˆå—ä¿¡
            socket.on('gift', (data) => {
                const div = document.createElement('div');
                div.style.color = "#ffea00";
                div.style.fontWeight = "bold";
                div.innerHTML = `ğŸ ${data.user}ã•ã‚“ãŒã€Œ${data.gift}ã€ã‚’è´ˆã‚Šã¾ã—ãŸï¼`;
                log.prepend(div);
            });

            socket.on('disconnect', () => {
                statusLabel.innerText = "âšªï¸ åˆ‡æ–­ã•ã‚Œã¾ã—ãŸ";
                statusLabel.style.background = "#333";
            });
        }
    </script>
</body>
</html>
