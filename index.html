<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1.0,user-scalable=no">
    <title>macfinity ULTIMATE</title>
    <style>
        :root { --primary: #ff0050; --accent: #ffb703; --bg: #0f1115; --card: #1c2128; --border: #2f3338; }
        body { background: var(--bg); color: #fff; font-family: -apple-system, sans-serif; margin: 0; padding-bottom: env(safe-area-inset-bottom); }
        
        /* ナビゲーション */
        .header { background: var(--card); border-bottom: 1px solid var(--border); position: sticky; top: 0; z-index: 100; }
        .logo-area { display: flex; align-items: center; padding: 12px 15px; }
        .logo-icon { width: 32px; height: 32px; background: linear-gradient(45deg, var(--primary), #00f2ea); border-radius: 8px; margin-right: 12px; display: flex; align-items: center; justify-content: center; font-size: 10px; font-weight: bold; }
        
        /* タブ切り替え（ホーム・アラート・TTS） */
        .tabs { display: flex; background: var(--card); border-bottom: 1px solid var(--border); }
        .tab { flex: 1; text-align: center; padding: 14px; font-size: 13px; color: #888; cursor: pointer; border-bottom: 3px solid transparent; }
        .tab.active { color: #fff; border-bottom-color: var(--primary); font-weight: bold; }

        /* コンテンツ */
        .content { display: none; padding: 15px; max-width: 550px; margin: auto; }
        .content.active { display: block; }
        .card { background: var(--card); border-radius: 12px; padding: 18px; margin-bottom: 15px; border: 1px solid var(--border); }
        .card-h { font-size: 11px; color: #888; text-transform: uppercase; margin-bottom: 15px; font-weight: bold; letter-spacing: 1px; }

        /* 入力UI */
        input[type="text"], input[type="number"], textarea { width: 100%; padding: 12px; background: #000; border: 1px solid var(--border); border-radius: 8px; color: #fff; font-size: 16px; box-sizing: border-box; margin-bottom: 10px; }
        .btn-start { width: 100%; padding: 18px; background: #d63384; border: none; border-radius: 10px; color: #fff; font-weight: bold; font-size: 16px; cursor: pointer; }
        .row { display: flex; justify-content: space-between; align-items: center; padding: 12px 0; border-bottom: 1px solid #2a2e33; }
        input[type="range"] { width: 100%; accent-color: var(--accent); }
        input[type="checkbox"] { width: 40px; height: 20px; accent-color: #2ecc71; }
        
        #log { background: #000; border-radius: 8px; padding: 12px; font-family: monospace; font-size: 11px; height: 180px; overflow-y: auto; color: #0f0; border: 1px solid var(--border); margin-top: 10px; line-height: 1.5; }
    </style>
</head>
<body>

    <div class="header">
        <div class="logo-area"><div class="logo-icon">mac</div><h1 style="font-size: 17px; margin: 0;">macfinity</h1></div>
        <div class="tabs">
            <div class="tab active" onclick="tab('home')">ホーム</div>
            <div class="tab" onclick="tab('alerts')">アラート</div>
            <div class="tab" onclick="tab('tts')">TTS/スパム</div>
        </div>
    </div>

    <div id="home" class="content active">
        <div class="card">
            <div class="card-h">接続設定</div>
            <input type="text" id="uid" value="creok.farm" placeholder="TikTok ID (@なし)">
            <button class="btn-start" id="start">サウンドアラートと読み上げを開始</button>
        </div>
        <div class="card">
            <div class="card-h">ライブログ</div>
            <div id="log">システム待機中...</div>
        </div>
    </div>

    <div id="alerts" class="content">
        <div class="card">
            <div class="card-h">サウンドアラート有効化</div>
            <div class="row"><span>フォローする</span><input type="checkbox" id="fOn" checked></div>
            <div class="row"><span>あらゆるギフト</span><input type="checkbox" id="gOn" checked></div>
            <div class="row"><span>シェアする</span><input type="checkbox" id="sOn" checked></div>
            <div class="row"><span>LIVE入室</span><input type="checkbox" id="jOn"></div>
        </div>
    </div>

    <div id="tts" class="content">
        <div class="card">
            <div class="card-h">音声設定</div>
            <div style="margin-bottom:15px;">速度: <span id="sv">50</span><input type="range" id="speed" min="10" max="100" value="50"></div>
            <div>ピッチ: <span id="pv">50</span><input type="range" id="pitch" min="10" max="100" value="50"></div>
        </div>
        <div class="card">
            <div class="card-h">スパム対策・制限</div>
            <div class="row"><span>最低コイン数</span><input type="number" id="minC" value="1" style="width:80px; margin:0;"></div>
            <div class="row"><span>クールダウン(秒)</span><input type="number" id="cd" value="3" style="width:80px; margin:0;"></div>
            <div class="row"><span>チャット読み上げ</span><input type="checkbox" id="cOn" checked></div>
        </div>
        <div class="card">
            <div class="card-h">テキストテンプレート</div>
            <textarea id="tplG" rows="2">{nickname}さん、{giftName}ありがとう！</textarea>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/tiktok-live-connect@0.1.1/dist/browser/tiktok-live-connect.min.js"></script>
    <script>
        function tab(id) {
            document.querySelectorAll('.content').forEach(c => c.classList.remove('active'));
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            document.getElementById(id).classList.add('active');
            event.currentTarget.classList.add('active');
        }

        const log = document.getElementById('log'), btn = document.getElementById('start');
        const speed = document.getElementById('speed'), pitch = document.getElementById('pitch');
        let userLastTime = {};

        speed.oninput = () => document.getElementById('sv').innerText = speed.value;
        pitch.oninput = () => document.getElementById('pv').innerText = pitch.value;

        function speak(txt) {
            const u = new SpeechSynthesisUtterance(txt);
            u.lang = 'ja-JP';
            u.rate = speed.value / 50;
            u.pitch = pitch.value / 50;
            window.speechSynthesis.speak(u);
        }

        btn.onclick = () => {
            const id = document.getElementById('uid').value.trim();
            log.innerText = `Connecting... @${id}\n`;
            speak("マックフィニティを起動します。全機能無料モードです。");

            const con = new TikTokLiveConnector.WebcastPushConnection(id);
            con.connect().then(() => {
                log.prepend(`[CONNECTED] ライブに同期しました\n`);
                btn.style.background = "#28a745"; btn.innerText = "同期中 (ON)";
            }).catch(() => log.prepend(`[ERROR] IDを確認してください\n`));

            function checkSpam(uid) {
                const now = Date.now();
                const limit = document.getElementById('cd').value * 1000;
                if(userLastTime[uid] && (now - userLastTime[uid] < limit)) return true;
                userLastTime[uid] = now; return false;
            }

            con.on('chat', d => {
                if(!document.getElementById('cOn').checked || checkSpam(d.uniqueId)) return;
                log.prepend(`[CHAT] ${d.nickname}: ${d.comment}\n`);
                speak(`${d.nickname}、${d.comment}`);
            });

            con.on('gift', d => {
                if(!document.getElementById('gOn').checked || d.diamondCount < document.getElementById('minC').value) return;
                let m = document.getElementById('tplG').value.replace('{nickname}', d.nickname).replace('{giftName}', d.giftName);
                log.prepend(`[GIFT] ${d.nickname}: ${d.giftName}\n`);
                speak(m);
            });

            con.on('follow', d => {
                if(!document.getElementById('fOn').checked || checkSpam(d.uniqueId)) return;
                log.prepend(`[FOLLOW] ${d.nickname}\n`);
                speak(`${d.nickname}さん、フォローありがとう！`);
            });
        };
    </script>
</body>
</html>
