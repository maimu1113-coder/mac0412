<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=no">
    <title>TikTok èª­ã¿ä¸Šã’å›ã€å®Œå…¨ç‰ˆã€‘</title>
    <style>
        body { background:#000; color:#fff; text-align:center; font-family:sans-serif; margin:0; padding:20px; overflow-x:hidden; }
        .box { background:#1a1a1a; padding:15px; border-radius:15px; margin-bottom:15px; border:1px solid #333; }
        input { padding:15px; width:80%; border-radius:10px; border:none; font-size:16px; margin:10px 0; outline:none; }
        button { padding:15px; width:85%; background:#ff0050; color:#fff; border-radius:10px; border:none; font-weight:bold; font-size:18px; cursor:pointer; box-shadow:0 4px 10px rgba(255,0,80,0.3); }
        button:active { transform:scale(0.98); }
        #status { margin:15px; font-weight:bold; color:#ffdd00; font-size:14px; }
        #log { background:#000; height:350px; overflow-y:auto; border:1px solid #333; padding:10px; text-align:left; font-size:12px; border-radius:10px; line-height:1.6; }
        .chat { color:#00f2ea; margin-bottom:4px; }
        .gift { color:#ff0050; font-weight:bold; border-bottom:1px solid #333; padding-bottom:2px; }
    </style>
</head>
<body>

    <div class="box">
        <h3>TikTok èª­ã¿ä¸Šã’å›</h3>
        <input type="text" id="idInput" placeholder="TikTok ID (@æŠœã)" value="genkai_inpeita">
        <button id="sBtn">èª­ã¿ä¸Šã’ã‚’é–‹å§‹ã™ã‚‹</button>
        <div id="status">æº–å‚™ä¸­...</div>
    </div>

    <div id="log">ã“ã“ã«ã‚¤ãƒ™ãƒ³ãƒˆãŒè¡¨ç¤ºã•ã‚Œã¾ã™</div>

    <script src="https://cdn.jsdelivr.net/npm/tiktok-live-connect@0.1.1/dist/browser/tiktok-live-connect.min.js"></script>

    <script>
        const btn = document.getElementById('sBtn');
        const status = document.getElementById('status');
        const log = document.getElementById('log');

        function addLog(msg, type='') {
            const d = document.createElement('div');
            d.className = type;
            d.innerText = `[${new Date().toLocaleTimeString()}] ${msg}`;
            log.prepend(d);
        }

        // èµ·å‹•æ™‚ã®ãƒã‚§ãƒƒã‚¯
        function checkReady() {
            if (typeof TikTokLiveConnector !== 'undefined') {
                status.innerText = "â— åœæ­¢ä¸­ï¼ˆæ¥ç¶šæº–å‚™å®Œäº†ï¼‰";
                status.style.color = "#00ff00";
                return true;
            } else {
                status.innerText = "âš ï¸ æ¥ç¶šéƒ¨å“ã‚’èª­ã¿è¾¼ã¿ä¸­...ï¼ˆæ•°ç§’å¾…ã£ã¦ãã ã•ã„ï¼‰";
                return false;
            }
        }
        setInterval(checkReady, 2000);

        btn.onclick = () => {
            if (!checkReady()) {
                alert("ã¾ã æº–å‚™ãŒã§ãã¦ã„ã¾ã›ã‚“ã€‚10ç§’ã»ã©å¾…ã£ã¦ã‹ã‚‰ã‚‚ã†ä¸€åº¦æŠ¼ã—ã¦ãã ã•ã„ã€‚");
                return;
            }

            const tid = document.getElementById('idInput').value.trim();
            if (!tid) return;

            // éŸ³å£°ãƒ†ã‚¹ãƒˆ
            const u = new SpeechSynthesisUtterance("æ¥ç¶šã‚’é–‹å§‹ã—ã¾ã™");
            u.lang = 'ja-JP';
            window.speechSynthesis.speak(u);

            status.innerText = "â³ æ¥ç¶šã‚’è©¦ã¿ã¦ã„ã¾ã™...";
            addLog(`${tid} ã«æ¥ç¶šä¸­...`);

            try {
                const con = new TikTokLiveConnector.WebcastPushConnection(tid);

                con.connect().then(s => {
                    status.innerText = "âœ… æ¥ç¶šæˆåŠŸï¼é…ä¿¡ã‚’è¦‹å®ˆã£ã¦ã„ã¾ã™";
                    status.style.color = "#00ff00";
                    addLog("ç¹‹ãŒã‚Šã¾ã—ãŸï¼");
                }).catch(e => {
                    status.innerText = "âŒ æ¥ç¶šå¤±æ•—ï¼ˆé…ä¿¡å¤–ã‹IDãƒŸã‚¹ï¼‰";
                    status.style.color = "#ff4444";
                    addLog("ã‚¨ãƒ©ãƒ¼: " + e);
                });

                // ãƒãƒ£ãƒƒãƒˆèª­ã¿ä¸Šã’
                con.on('chat', data => {
                    addLog(`${data.nickname}: ${data.comment}`, 'chat');
                    const m = new SpeechSynthesisUtterance(`${data.nickname}ã•ã‚“ã€${data.comment}`);
                    m.lang = 'ja-JP';
                    m.rate = 1.1; // å°‘ã—æ—©å£ã§èª­ã¿ä¸Šã’
                    window.speechSynthesis.speak(m);
                });

                // ã‚®ãƒ•ãƒˆèª­ã¿ä¸Šã’
                con.on('gift', data => {
                    const txt = `${data.nickname}ã•ã‚“ãŒ${data.giftName}ã‚’è´ˆã‚Šã¾ã—ãŸï¼`;
                    addLog("ğŸ " + txt, 'gift');
                    const m = new SpeechSynthesisUtterance(txt);
                    m.lang = 'ja-JP';
                    window.speechSynthesis.speak(m);
                });

            } catch (err) {
                addLog("èµ·å‹•ãƒŸã‚¹: " + err);
            }
        };
    </script>
</body>
</html>
