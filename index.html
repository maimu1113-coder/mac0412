<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>TikTokãƒ—ãƒ­èª­ã¿ä¸Šã’å›</title>
    <style>
        body { background:#000; color:#fff; text-align:center; padding-top:20px; font-family:sans-serif; margin:0; }
        .container { padding: 20px; }
        input { padding:15px; font-size:16px; width:80%; margin-bottom:10px; border-radius:10px; border:none; color:#000; }
        button { padding:15px; font-size:18px; background:#ff0050; color:#fff; border:none; border-radius:10px; width:85%; font-weight:bold; cursor:pointer; }
        #status { margin:15px 0; color:#ffdd00; font-size:14px; font-weight:bold; }
        #log { background:#111; margin:10px; padding:15px; height:300px; overflow-y:auto; border-radius:10px; border:1px solid #333; text-align:left; font-size:13px; }
        .event-gift { color: #ff0050; font-weight: bold; }
        .event-follow { color: #00f2ea; }
    </style>
</head>
<body>
    <div class="container">
        <h2>TikTokèª­ã¿ä¸Šã’ Pro</h2>
        <input type="text" id="idInput" placeholder="TikTok IDã‚’å…¥åŠ› (@æŠœã)">
        <br>
        <button id="s">èª­ã¿ä¸Šã’ã‚’é–‹å§‹ã™ã‚‹</button>
        <div id="status">åœæ­¢ä¸­</div>
        <div id="log">ã“ã“ã«ã‚¤ãƒ™ãƒ³ãƒˆï¼ˆã‚®ãƒ•ãƒˆã‚„ã‚³ãƒ¡ãƒ³ãƒˆï¼‰ãŒè¡¨ç¤ºã•ã‚Œã¾ã™</div>
    </div>

    <script type="module">
        import { WebcastPushConnection } from 'https://cdn.jsdelivr.net/npm/tiktok-live-connect@0.1.1/dist/browser/tiktok-live-connect.min.js';

        const btn = document.getElementById('s');
        const status = document.getElementById('status');
        const log = document.getElementById('log');
        const idInput = document.getElementById('idInput');

        function addLog(msg, className = '') {
            const p = document.createElement('div');
            p.className = className;
            p.innerText = msg;
            log.prepend(p);
        }

        function speak(text) {
            const uttr = new SpeechSynthesisUtterance(text);
            uttr.lang = "ja-JP";
            uttr.rate = 1.2; // å°‘ã—é€Ÿã‚ã«è¨­å®š
            window.speechSynthesis.speak(uttr);
        }

        btn.onclick = () => {
            const tiktokId = idInput.value.trim();
            if (!tiktokId) { alert("IDã‚’å…¥åŠ›ã—ã¦ãã ã•ã„"); return; }

            speak("ãƒ—ãƒ­ãƒ¢ãƒ¼ãƒ‰ã§æ¥ç¶šã‚’é–‹å§‹ã—ã¾ã™ã€‚");
            status.innerText = "æ¥ç¶šä¸­...";
            
            const con = new WebcastPushConnection(tiktokId);

            con.connect().then(state => {
                status.innerText = "âœ… ãƒ—ãƒ­ãƒ¢ãƒ¼ãƒ‰æ¥ç¶šä¸­ï¼";
                status.style.color = "#00ff00";
                addLog("ã‚·ã‚¹ãƒ†ãƒ ç¨¼åƒä¸­...");
            }).catch(err => {
                status.innerText = "âŒ ã‚¨ãƒ©ãƒ¼";
                addLog("ã‚¨ãƒ©ãƒ¼: " + err);
            });

            // ğŸ’¬ ã‚³ãƒ¡ãƒ³ãƒˆèª­ã¿ä¸Šã’
            con.on('chat', d => {
                addLog(`${d.nickname}: ${d.comment}`);
                speak(`${d.nickname}ã•ã‚“ã€${d.comment}`);
            });

            // ğŸ ã‚®ãƒ•ãƒˆæ¤œçŸ¥
            con.on('gift', d => {
                const msg = `æ„Ÿè¬ï¼${d.nickname}ã•ã‚“ãŒ${d.giftName}ã‚’è´ˆã‚Šã¾ã—ãŸï¼`;
                addLog(msg, 'event-gift');
                speak(msg);
            });

            // â• ãƒ•ã‚©ãƒ­ãƒ¼æ¤œçŸ¥
            con.on('follow', d => {
                const msg = `${d.nickname}ã•ã‚“ãŒãƒ•ã‚©ãƒ­ãƒ¼ã—ã¦ãã‚Œã¾ã—ãŸï¼`;
                addLog(msg, 'event-follow');
                speak(msg);
            });

            // ğŸ“¢ ã‚·ã‚§ã‚¢æ¤œçŸ¥
            con.on('share', d => {
                speak(`${d.nickname}ã•ã‚“ãŒãƒ©ã‚¤ãƒ–ã‚’ã‚·ã‚§ã‚¢ã—ã¾ã—ãŸï¼ã‚ã‚ŠãŒã¨ã†ï¼`);
            });

            // ğŸ‘‹ å…¥å®¤é€šçŸ¥ï¼ˆè¦–è´è€…ãŒå¢—ãˆãŸã¨ãï¼‰
            con.on('member', d => {
                addLog(`${d.nickname}ã•ã‚“ãŒå…¥å®¤ã—ã¾ã—ãŸ`);
                // å…¥å®¤ã¯äººæ•°ãŒå¤šã„ã¨å–‹ã‚Šã™ãã‚‹ã®ã§ã€ãƒ­ã‚°è¡¨ç¤ºã®ã¿ã«ã™ã‚‹ã®ãŒä¸€èˆ¬çš„ã§ã™
            });
        };
    </script>
</body>
</html>
